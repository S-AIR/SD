<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html>
<head>
<title>ZC103SDR0011F01</title>
</head>
<body bgcolor="#FFFFE0">
<font size="3" face = "Arial" color="#000000"><b>Code listing for: ZC103SDR0011F01</b></font>
<br>
<font size="3" face = "Arial" color="#000000"><b>Description:  Include ZC103SDR0011F01</b></font>
<hr>
<pre width="100">
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Include          ZC103SDR0011F01</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_year</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM set_year .

  pa_year = sy-datum+0(4).

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form get_main_grade_data</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM get_main_grade_data .

<font color ="#0000FF">*-- Get main grade data</font>
  SELECT bpid, bpname, bptype, grade, current_score, last_eval_date, acc_delay_days,
         blocked_flag, limit_amt_year, used_amt_year, eval_year, currency, dunning_date,
         erdat, erzet, ernam, aedat, aezet, aenam
    FROM zc103sdt0016
    WHERE eval_year EQ @pa_year
    INTO CORRESPONDING FIELDS OF TABLE @gt_credit.

  IF ( gt_credit IS INITIAL ).
    MESSAGE i000 WITH TEXT-w01 DISPLAY LIKE 'W'.
    LEAVE SCREEN.
  ENDIF.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_iofield_value</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM set_iofield_value .

  CLEAR : gv_vvip, gv_vip, gv_gold, gv_silver, gv_bronze.

<font color ="#0000FF">*-- BP grade IO field</font>
  LOOP AT gt_credit INTO gs_credit.
    CASE gs_credit-grade.
      WHEN 'VVIP'.
        gv_vvip += 1.
      WHEN 'VIP'.
        gv_vip += 1.
      WHEN 'GOLD'.
        gv_gold += 1.
      WHEN 'SILVER'.
        gv_silver += 1.
      WHEN 'BRONZE'.
        gv_bronze += 1.
    ENDCASE.
  ENDLOOP.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_display_table</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM set_display_table .

  IF ( gt_cdisplay IS INITIAL ).
    LOOP AT gt_credit INTO gs_credit WHERE bptype = 'T'.
      gs_cdisplay = CORRESPONDING #( gs_credit ).
      APPEND gs_cdisplay TO gt_cdisplay.
    ENDLOOP.

<font color ="#0000FF">*-- Change Value field to Text</font>
    PERFORM set_cdisplay_to_text.
  ENDIF.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_cdisplay_to_text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM set_cdisplay_to_text .

  LOOP AT gt_cdisplay ASSIGNING FIELD-SYMBOL(&lt;fs_cdis&gt;).
<font color ="#0000FF">*-- Change bptype field</font>
    CASE &lt;fs_cdis&gt;-bptype.
      WHEN 'T'.
        &lt;fs_cdis&gt;-bptype = '여행사'.
      WHEN 'B'.
        &lt;fs_cdis&gt;-bptype = '계약 화물사'.
      WHEN 'NB'.
        &lt;fs_cdis&gt;-bptype = '미계약 화물사'.
    ENDCASE.

<font color ="#0000FF">*-- Change Blocked_flag field</font>
    CASE &lt;fs_cdis&gt;-blocked_flag.
      WHEN 'Y'.
        &lt;fs_cdis&gt;-blocked_flag = '거래 가능'.
      WHEN 'N'.
        &lt;fs_cdis&gt;-blocked_flag = '거래 불가능'.
    ENDCASE.

<font color ="#0000FF">*-- Concatenate acc days field</font>
    CONCATENATE &lt;fs_cdis&gt;-acc_delay_days '일' INTO &lt;fs_cdis&gt;-acc_delay_days.

<font color ="#0000FF">*-- Concatenate score field</font>
    CONCATENATE &lt;fs_cdis&gt;-current_score '점' INTO &lt;fs_cdis&gt;-current_score.

  ENDLOOP.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form get_bill_data</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM get_bill_data .

<font color ="#0000FF">*-- Get bill data</font>
  SELECT bpid, payment_date, total_amount
    FROM zc103sdt0004
    WHERE gjahr EQ @pa_year
      AND custid EQ ''
    INTO CORRESPONDING FIELDS OF TABLE @gt_bill.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form display_chart</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM display_chart .

  CLEAR : go_ixml,
          go_ixml_sf,
          go_ixml_docu,
          go_ixml_ostream,
          go_ixml_encoding,
          go_chartdata,
          go_categories,
          go_category,
          go_series,
          go_point,
          go_value.

  CLEAR : gv_xstring.

  go_ixml = cl_ixml=&gt;create(  ).
  go_ixml_sf = go_ixml-&gt;create_stream_factory( ).

  go_ixml_docu = go_ixml-&gt;create_document( ).

  go_ixml_encoding = go_ixml-&gt;create_encoding(
                       byte_order    = if_ixml_encoding=&gt;co_little_endian
                       character_set = 'utf-8' ).

  go_ixml_docu-&gt;set_encoding( encoding = go_ixml_encoding ).

<font color ="#0000FF">*-- Now build a DOM, representing an XML document with chart data</font>
  go_chartdata = go_ixml_docu-&gt;create_simple_element(
                                        name   = 'ChartData'
                                        parent = go_ixml_docu ).

<font color ="#0000FF">*-- Categories (parent)</font>
  go_categories = go_ixml_docu-&gt;create_simple_element(
                                        name   = 'Categories'
                                        parent = go_chartdata ).

  PERFORM set_category_value.
  PERFORM set_chart_value.
  PERFORM design_mode.

  go_chart-&gt;set_data( xdata = gv_xstring ).
  go_chart-&gt;render( ).

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_category_value</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM set_category_value .

  DATA : lv_value TYPE string.

<font color ="#0000FF">*-- Categories (children)</font>
  go_category = go_ixml_docu-&gt;create_simple_element(
                                        name   = 'Category'
                                        parent = go_categories ).
  go_category-&gt;if_ixml_node~set_value( '1월' ).


  go_category = go_ixml_docu-&gt;create_simple_element(
                                      name   = 'Category'
                                      parent = go_categories ).
  go_category-&gt;if_ixml_node~set_value( '2월' ).

  go_category = go_ixml_docu-&gt;create_simple_element(
                                      name   = 'Category'
                                      parent = go_categories ).
  go_category-&gt;if_ixml_node~set_value( '3월' ).

  go_category = go_ixml_docu-&gt;create_simple_element(
                                      name   = 'Category'
                                      parent = go_categories ).
  go_category-&gt;if_ixml_node~set_value( '4월' ).

  go_category = go_ixml_docu-&gt;create_simple_element(
                                      name   = 'Category'
                                      parent = go_categories ).
  go_category-&gt;if_ixml_node~set_value( '5월' ).

  go_category = go_ixml_docu-&gt;create_simple_element(
                                      name   = 'Category'
                                      parent = go_categories ).
  go_category-&gt;if_ixml_node~set_value( '6월' ).

  go_category = go_ixml_docu-&gt;create_simple_element(
                                      name   = 'Category'
                                      parent = go_categories ).
  go_category-&gt;if_ixml_node~set_value( '7월' ).

  go_category = go_ixml_docu-&gt;create_simple_element(
                                      name   = 'Category'
                                      parent = go_categories ).
  go_category-&gt;if_ixml_node~set_value( '8월' ).

  go_category = go_ixml_docu-&gt;create_simple_element(
                                      name   = 'Category'
                                      parent = go_categories ).
  go_category-&gt;if_ixml_node~set_value( '9월' ).

  go_category = go_ixml_docu-&gt;create_simple_element(
                                      name   = 'Category'
                                      parent = go_categories ).
  go_category-&gt;if_ixml_node~set_value( '10월' ).

  go_category = go_ixml_docu-&gt;create_simple_element(
                                      name   = 'Category'
                                      parent = go_categories ).
  go_category-&gt;if_ixml_node~set_value( '11월' ).

  go_category = go_ixml_docu-&gt;create_simple_element(
                                      name   = 'Category'
                                      parent = go_categories ).
  go_category-&gt;if_ixml_node~set_value( '12월' ).

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_chart_value</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM set_chart_value .

  DATA : lv_value  TYPE string,
         lv_bpname TYPE string,
         lv_month  TYPE string,
         lv_amount TYPE string.

<font color ="#0000FF">*-- Get Bpname</font>
  SELECT SINGLE bpname
    FROM zc103sdt0001
    WHERE bpid EQ @gs_chart-bpid
    INTO ( @lv_bpname ).

<font color ="#0000FF">*-- Build series (we need only 1)</font>
  go_series = go_ixml_docu-&gt;create_simple_element(
                                                    name = 'Series'
                                                    parent = go_chartdata ).
  go_series-&gt;set_attribute( name  = 'label'
                            value = lv_bpname ). "'Series1' ).

  LOOP AT gt_chart INTO gs_chart.

    lv_month = gs_chart-month.
    lv_amount = gs_chart-total_amount.

<font color ="#0000FF">*-- total_amount category</font>
    go_point = go_ixml_docu-&gt;create_simple_element(
                                                    name = 'Point'
                                                    parent = go_series ).
    go_point-&gt;set_attribute( name  = 'label'
                             value = lv_month ).

    go_value = go_ixml_docu-&gt;create_simple_element(
                                                    name = 'Value'
                                                    parent = go_point ).

    go_value-&gt;if_ixml_node~set_value( lv_amount ).

  ENDLOOP.

<font color ="#0000FF">*-- CREATE ostream (into string variable) and render document into stream</font>
  go_ixml_ostream = go_ixml_sf-&gt;create_ostream_xstring( gv_xstring ).
  go_ixml_docu-&gt;render( go_ixml_ostream ). "here f_xstring is filled

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form design_mode</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM design_mode .

<font color ="#0000FF">**********************************************************************</font>
<font color ="#0000FF">* Chart type : Only Columns and Lines</font>
<font color ="#0000FF">**********************************************************************</font>
  DATA: l_win_chart   TYPE REF TO cl_gui_chart_engine_win,
        g_design_mode.

  CATCH SYSTEM-EXCEPTIONS move_cast_error = 1.
    l_win_chart ?= go_chart-&gt;get_control( ).
  ENDCATCH.

  IF sy-subrc IS INITIAL.

    l_win_chart-&gt;set_design_mode( flag = g_design_mode event = 'X' ).
    l_win_chart-&gt;restrict_property_events( events = 'ChartType' ).

    l_win_chart-&gt;restrict_chart_types( charttypes = 'Columns' ).

  ENDIF.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_subscreen</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM set_subscreen .

<font color ="#0000FF">*-- SET Subscreen Number</font>
  CASE gc_tab-activetab.
    WHEN 'TAB1'.
      gv_subscreen = '0101'.
      PERFORM set_cdisplay_data USING 'TA'.
    WHEN 'TAB2'.
      gv_subscreen = '0102'.
      PERFORM set_cdisplay_data USING 'CC'.
    WHEN 'TAB3'.
      gv_subscreen = '0103'.
      PERFORM set_cdisplay_data USING 'NC'.
    WHEN OTHERS.
      gc_tab-activetab = 'TAB1'.
      gv_subscreen = '0101'.
  ENDCASE.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_cdisplay_data</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&      --&gt; P_</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM set_cdisplay_data  USING pv_kind.

<font color ="#0000FF">*-- Set Data</font>
  CLEAR : gt_cdisplay, gs_cdisplay.
  CASE pv_kind.
    WHEN 'TA'.
      LOOP AT gt_credit INTO gs_credit WHERE bptype = 'T'.
        gs_cdisplay = CORRESPONDING #( gs_credit ).
        APPEND gs_cdisplay TO gt_cdisplay.
      ENDLOOP.
      PERFORM set_cdisplay_to_text.

    WHEN 'CC'.
      LOOP AT gt_credit INTO gs_credit WHERE bptype = 'B'.
        gs_cdisplay = CORRESPONDING #( gs_credit ).
        APPEND gs_cdisplay TO gt_cdisplay.
      ENDLOOP.
      PERFORM set_cdisplay_to_text.

    WHEN 'NC'.
      LOOP AT gt_credit INTO gs_credit WHERE bptype = 'NB'.
        gs_cdisplay = CORRESPONDING #( gs_credit ).
        APPEND gs_cdisplay TO gt_cdisplay.
      ENDLOOP.
      PERFORM set_cdisplay_to_text.
  ENDCASE.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form display_101_screen</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM display_101_screen .

  IF go_101_container IS INITIAL.

    PERFORM set_101_field_catalog USING : 'X' 'BPID' 'ZC103SDT0016' ' ' ' ',
                                          ' ' 'BPNAME' 'ZC103SDT0016' 'C' 'X',
                                          ' ' 'BPTYPE' 'ZC103SDT0016' 'C' 'X',
                                          ' ' 'GRADE' 'ZC103SDT0016' 'C' 'X',
                                          ' ' 'LAST_EVAL_DATE' 'ZC103SDT0016' ' ' ' ',
                                          ' ' 'ACC_DELAY_DAYS' 'ZC103SDT0016' ' ' ' ',
                                          ' ' 'BLOCKED_FLAG' 'ZC103SDT0016' 'C' 'X',
                                          ' ' 'EVAL_YEAR' 'ZC103SDT0016' ' ' ' '.

    PERFORM create_101_object.
    PERFORM set_101_layout_variant.
    PERFORM exclude_101_toolbar.

    SET HANDLER : lcl_event_handler=&gt;double_click FOR go_101_alv_grid.

<font color ="#0000FF">*-- Display Travel Agency alv</font>
    CALL METHOD go_101_alv_grid-&gt;set_table_for_first_display
      EXPORTING
        is_variant           = gs_101_variant
        i_save               = 'A'
        i_default            = 'X'
        is_layout            = gs_101_layout
        it_toolbar_excluding = gt_ui_functions
      CHANGING
        it_outtab            = gt_cdisplay
        it_fieldcatalog      = gt_101_fcat.

  ENDIF.

  PERFORM refresh_101_table.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_101_field_catalog</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&      --&gt; P_</font>
<font color ="#0000FF">*&      --&gt; P_</font>
<font color ="#0000FF">*&      --&gt; P_</font>
<font color ="#0000FF">*&      --&gt; P_</font>
<font color ="#0000FF">*&      --&gt; P_</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM set_101_field_catalog  USING pv_key pv_field pv_table pv_just pv_emph.

  gs_101_fcat-key = pv_key.
  gs_101_fcat-fieldname = pv_field.
  gs_101_fcat-ref_table = pv_table.
  gs_101_fcat-just = pv_just.
  gs_101_fcat-emphasize = pv_emph.

  APPEND gs_101_fcat TO gt_101_fcat.
  CLEAR : gs_101_fcat.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form create_101_object</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM create_101_object .

  CREATE OBJECT go_101_container
    EXPORTING
      container_name = '101_CONT'.

  CREATE OBJECT go_101_alv_grid
    EXPORTING
      i_parent = go_101_container.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_101_layout_variant</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM set_101_layout_variant .

<font color ="#0000FF">*-- SET 101 layout</font>
  gs_101_layout-zebra = abap_true.
  gs_101_layout-cwidth_opt = 'A'.
  gs_101_layout-sel_mode = 'D'.

<font color ="#0000FF">*-- Set 101 variant</font>
  gs_101_variant-report = sy-repid.
  gs_101_variant-handle = 'SUB1'.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form exclude_101_toolbar</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM exclude_101_toolbar .

  DATA : ls_ui_functions TYPE ui_func.

  ls_ui_functions = cl_gui_alv_grid=&gt;mc_fc_loc_undo.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=&gt;mc_fc_loc_copy.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=&gt;mc_fc_loc_copy_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=&gt;mc_fc_loc_cut.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=&gt;mc_fc_loc_delete_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=&gt;mc_fc_loc_insert_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=&gt;mc_fc_loc_append_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=&gt;mc_fc_loc_paste.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=&gt;mc_fc_loc_paste_new_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=&gt;mc_fc_refresh.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=&gt;mc_fc_auf.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=&gt;mc_fc_average.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=&gt;mc_fc_print.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=&gt;mc_fc_graph.
  APPEND ls_ui_functions TO gt_ui_functions.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form refresh_c_table</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM refresh_101_table .

  DATA : ls_stable TYPE lvc_s_stbl.

  ls_stable-row = abap_true.
  ls_stable-col = abap_true.

  CALL METHOD go_101_alv_grid-&gt;refresh_table_display
    EXPORTING
      is_stable = ls_stable.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form display_102_screen</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM display_102_screen .

  IF go_102_container IS INITIAL.

    PERFORM create_102_object.
    PERFORM set_102_layout_variant.

    SET HANDLER : lcl_event_handler=&gt;double_click FOR go_102_alv_grid.

<font color ="#0000FF">*-- Display Contracted Carrier alv</font>
    CALL METHOD go_102_alv_grid-&gt;set_table_for_first_display
      EXPORTING
        is_variant           = gs_102_variant
        i_save               = 'A'
        i_default            = 'X'
        is_layout            = gs_102_layout
        it_toolbar_excluding = gt_ui_functions
      CHANGING
        it_outtab            = gt_cdisplay
        it_fieldcatalog      = gt_101_fcat.

  ENDIF.

  PERFORM refresh_102_table.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form create_102_object</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM create_102_object .

  CREATE OBJECT go_102_container
    EXPORTING
      container_name = '102_CONT'.

  CREATE OBJECT go_102_alv_grid
    EXPORTING
      i_parent = go_102_container.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_102_layout_variant</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM set_102_layout_variant .

<font color ="#0000FF">*-- Set 102 layout</font>
  gs_102_layout-zebra = abap_true.
  gs_102_layout-cwidth_opt = 'A'.
  gs_102_layout-sel_mode = 'D'.

<font color ="#0000FF">*-- Set 102 variant</font>
  gs_102_variant-report = sy-repid.
  gs_102_variant-handle = 'SUB2'.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form refresh_102_table</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM refresh_102_table .

  DATA : ls_stable TYPE lvc_s_stbl.

  ls_stable-row = abap_true.
  ls_stable-col = abap_true.

  CALL METHOD go_102_alv_grid-&gt;refresh_table_display
    EXPORTING
      is_stable = ls_stable.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form display_103_screen</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM display_103_screen .

  IF go_103_container IS INITIAL.

    PERFORM create_103_object.
    PERFORM set_103_layout_variant.

    SET HANDLER : lcl_event_handler=&gt;double_click FOR go_103_alv_grid.

<font color ="#0000FF">*-- Display Non-Contracted Carrier alv</font>
    CALL METHOD go_103_alv_grid-&gt;set_table_for_first_display
      EXPORTING
        is_variant           = gs_103_variant
        i_save               = 'A'
        i_default            = 'X'
        is_layout            = gs_103_layout
        it_toolbar_excluding = gt_ui_functions
      CHANGING
        it_outtab            = gt_cdisplay
        it_fieldcatalog      = gt_101_fcat.

  ENDIF.

  PERFORM refresh_103_table.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form create_103_object</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM create_103_object .

  CREATE OBJECT go_103_container
    EXPORTING
      container_name = '103_CONT'.

  CREATE OBJECT go_103_alv_grid
    EXPORTING
      i_parent = go_103_container.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_103_layout_variant</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM set_103_layout_variant .

<font color ="#0000FF">*-- SET 103 layout</font>
  gs_103_layout-zebra = abap_true.
  gs_103_layout-cwidth_opt = 'A'.
  gs_103_layout-sel_mode = 'D'.

<font color ="#0000FF">*-- Set 103 variant</font>
  gs_103_variant-report = sy-repid.
  gs_103_variant-handle = 'SUB3'.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form refresh_103_table</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM refresh_103_table .

  DATA : ls_stable TYPE lvc_s_stbl.

  ls_stable-row = abap_true.
  ls_stable-col = abap_true.

  CALL METHOD go_103_alv_grid-&gt;refresh_table_display
    EXPORTING
      is_stable = ls_stable.


ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form double_click</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&      --&gt; E_ROW</font>
<font color ="#0000FF">*&      --&gt; E_COLUMN</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM double_click  USING    pv_row
                            pv_column.

  DATA : BEGIN OF ls_detail,
           grade          TYPE zc103sdt0016-grade,
           current_score  TYPE zc103sdt0016-current_score,
           last_eval_date TYPE zc103sdt0016-last_eval_date,
           blocked_flag   TYPE zc103sdt0016-blocked_flag,
           limit_amt_year TYPE zc103sdt0016-limit_amt_year,
           used_amt_year  TYPE zc103sdt0016-used_amt_year,
           limit_rate     TYPE int4,
           currency       TYPE zc103sdt0016-currency,
         END OF ls_detail.

  DATA : BEGIN OF ls_bp,
           bpid        TYPE zc103sdt0001-bpid,
           bptype      TYPE zc103sdt0001-bptype,
           paymentterm TYPE zc103sdt0001-paymentterm,
           bpname      TYPE zc103sdt0001-bpname,
           email       TYPE zc103sdt0001-email,
         END OF ls_bp.

  DATA : ls_chart TYPE ts_chart,
         lt_chart TYPE SORTED TABLE OF ts_chart
                  WITH UNIQUE KEY bpid month currency.

  DATA : lv_tabix TYPE sy-tabix.

  CLEAR : gs_bp, gs_gdetail, gs_chart, gt_chart.

  READ TABLE gt_cdisplay INTO gs_cdisplay INDEX pv_row.

<font color ="#0000FF">*-- Get BP Info IO field</font>
  SELECT SINGLE bpid, bptype, paymentterm, bpname, email
    FROM zc103sdt0001
    WHERE bpid EQ @gs_cdisplay-bpid
    INTO CORRESPONDING FIELDS OF @ls_bp.

<font color ="#0000FF">*-- Get Credit Info Field</font>
  SELECT SINGLE grade, current_score, last_eval_date, blocked_flag,
                limit_amt_year, used_amt_year, currency
    FROM zc103sdt0016
    WHERE bpid EQ @gs_cdisplay-bpid
    INTO CORRESPONDING FIELDS OF @ls_detail.

<font color ="#0000FF">*-- Calculate limit_rate</font>
  IF ( ls_detail-used_amt_year EQ 0 ) OR
     ( ls_detail-limit_amt_year EQ 0 ).
    ls_detail-limit_rate = 0.
  ELSE.
    ls_detail-limit_rate = ( ls_detail-used_amt_year / ls_detail-limit_amt_year ) * 100.
  ENDIF.

<font color ="#0000FF">*-- Move data</font>
  gs_gdetail = CORRESPONDING #( ls_detail ).

<font color ="#0000FF">*-- Change Value field to text</font>
  CASE gs_gdetail-blocked_flag.
    WHEN 'Y'.
      gs_gdetail-blocked_flag = '거래 가능'.
    WHEN 'N'.
      gs_gdetail-blocked_flag = '거래 불가능'.
  ENDCASE.

  gs_bp = CORRESPONDING #( ls_bp ).

  CASE gs_bp-bptype.
    WHEN 'T'.
      gs_bp-bptype = '여행사'.
    WHEN 'B'.
      gs_bp-bptype = '계약 화물사'.
    WHEN 'NB'.
      gs_bp-bptype = '미계약 화물사'.
  ENDCASE.

  CASE gs_bp-paymentterm.
    WHEN 'T001'.
      gs_bp-paymentterm = '즉시지급'.
    WHEN 'T030'.
      gs_bp-paymentterm = '30일'.
    WHEN 'T060'.
      gs_bp-paymentterm = '60일'.
  ENDCASE.

<font color ="#0000FF">*-- Concatenate rate field</font>
  CONCATENATE gs_gdetail-limit_rate '%' INTO gs_gdetail-limit_rate.

<font color ="#0000FF">*-- For Chart Data</font>
  SELECT bpid, payment_date, total_amount, currency
    FROM zc103sdt0004
    WHERE bpid EQ @gs_cdisplay-bpid
      AND gjahr EQ @pa_year
      AND billing_status EQ 'Y'
      AND payment_date NE '00000000'
    INTO CORRESPONDING FIELDS OF TABLE @gt_bill.

  IF ( gt_bill IS INITIAL ).
    MESSAGE s000 WITH '대상 대금 데이터가 존재하지 않습니다.' DISPLAY LIKE 'W'.
    CLEAR : gs_gdetail.
    LEAVE TO SCREEN 100.
  ENDIF.

  LOOP AT gt_bill ASSIGNING FIELD-SYMBOL(&lt;fs_bill&gt;).
    &lt;fs_bill&gt;-payment_date = &lt;fs_bill&gt;-payment_date+4(2).
  ENDLOOP.

  READ TABLE gt_bill INTO gs_bill INDEX 1.

<font color ="#0000FF">*-- Set chart month</font>
  gt_chart = VALUE #( ( bpid = gs_bill-bpid currency = gs_bill-currency month = '01' )
                      ( bpid = gs_bill-bpid currency = gs_bill-currency month = '02' )
                      ( bpid = gs_bill-bpid currency = gs_bill-currency month = '03' )
                      ( bpid = gs_bill-bpid currency = gs_bill-currency month = '04' )
                      ( bpid = gs_bill-bpid currency = gs_bill-currency month = '05' )
                      ( bpid = gs_bill-bpid currency = gs_bill-currency month = '06' )
                      ( bpid = gs_bill-bpid currency = gs_bill-currency month = '07' )
                      ( bpid = gs_bill-bpid currency = gs_bill-currency month = '08' )
                      ( bpid = gs_bill-bpid currency = gs_bill-currency month = '09' )
                      ( bpid = gs_bill-bpid currency = gs_bill-currency month = '10' )
                      ( bpid = gs_bill-bpid currency = gs_bill-currency month = '11' )
                      ( bpid = gs_bill-bpid currency = gs_bill-currency month = '12' ) ).

<font color ="#0000FF">*-- Move data</font>
  LOOP AT gt_bill INTO gs_bill.
    CLEAR ls_chart.
    ls_chart-bpid         = gs_bill-bpid.
    ls_chart-month   = gs_bill-payment_date+0(6).
    ls_chart-total_amount = gs_bill-total_amount.
    ls_chart-currency     = gs_bill-currency.
    COLLECT ls_chart INTO lt_chart.
  ENDLOOP.

  LOOP AT lt_chart INTO ls_chart.
    READ TABLE gt_chart ASSIGNING FIELD-SYMBOL(&lt;fs_chart&gt;)
    WITH KEY month = ls_chart-month.
    &lt;fs_chart&gt;-total_amount = ls_chart-total_amount.
  ENDLOOP.

  CALL METHOD cl_gui_cfw=&gt;set_new_ok_code
    EXPORTING
      new_code = 'ENTER'.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form display_100_screen</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM display_100_screen .

  IF go_main_container IS INITIAL.
    PERFORM create_100_object.
  ENDIF.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form create_100_object</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM create_100_object .

  CREATE OBJECT go_main_container
    EXPORTING
      container_name = '100_CONT'.

  CREATE OBJECT go_chart
    EXPORTING
      parent = go_main_container.



ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_credit_table</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM set_credit_table .

  SUBMIT zc103sdr0012 AND RETURN.

ENDFORM.
</pre>
<hr>
<font size="2" face = "Sans Serif">Extracted by Direct Download Enterprise version 1.3.1 - E.G.Mellodew. 1998-2005 UK. Sap Release 758
</font>
</body>
</html>
