```abap
*&---------------------------------------------------------------------*
*& Include          ZC103SDR0007F01
*&---------------------------------------------------------------------*
*&---------------------------------------------------------------------*
*& Form get_base_data
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM get_input_base_data .

*-- Get Normal Customer Data(B2C)
  SELECT input_head, input_line, input_type, custid, matid, countryfrom, countryto,
         flightid, scheduleid, conditionid, currency, unit_price, total_price,
         input_date, header_status, orderid, so_status, class, used_mileage,
         ticket_quantity, ticket_unit, meal_type, souvenir_qty, souvenir_unit,
         erdat, ernam, erzet, aedat, aenam, aezet
    FROM zc103_cds_idata
    WHERE input_type EQ 'CU'
      AND input_date EQ @pa_date
    INTO CORRESPONDING FIELDS OF TABLE @gt_cu.

*-- Get Travel Agency Data(B2B)
  SELECT input_head, input_line, input_type, bpid, unrg_custname, unrg_custemail,
         matid, countryfrom, countryto, flightid, scheduleid, conditionid, currency,
         unit_price, total_price, input_date, header_status, orderid, so_status,
         class, used_mileage, ticket_quantity, ticket_unit, meal_type, souvenir_qty,
         souvenir_unit, erdat, ernam, erzet, aedat, aenam, aezet
    FROM zc103_cds_idata
    WHERE input_type EQ 'TA'
    AND input_date EQ @pa_date
    INTO CORRESPONDING FIELDS OF TABLE @gt_ta.

*-- Get Contracted Carrier(B2B)
  SELECT input_head, input_line, input_type, bpid, matid, countryfrom, countryto,
         flightid, scheduleid, conditionid, currency, unit_price, total_price, input_date,
         header_status, orderid, so_status, weight, weight_unit, volume,
         erdat, ernam, erzet, aedat, aenam, aezet
    FROM zc103_cds_idata
    WHERE input_type EQ 'CC'
    AND input_date EQ @pa_date
    INTO CORRESPONDING FIELDS OF TABLE @gt_cc.

*-- Get Non-Contracted Carrier(B2B)
  SELECT input_head, input_line, input_type, bpid, unrg_bpname, unrg_bpemail, matid,
         countryfrom, countryto, flightid, scheduleid, conditionid, currency,
         unit_price, total_price, input_date, header_status, orderid, so_status,
         weight, weight_unit, volume, erdat, ernam, erzet, aedat, aenam, aezet
    FROM zc103_cds_idata
    WHERE input_type EQ 'NC'
    AND input_date EQ @pa_date
    INTO CORRESPONDING FIELDS OF TABLE @gt_nc.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_status
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_status .

*-- Set Customer Status
  LOOP AT gt_cu ASSIGNING FIELD-SYMBOL(<fs_cu>).
    IF <fs_cu>-so_status EQ 'N'.
      <fs_cu>-order_status = icon_led_red.
    ELSEIF <fs_cu>-so_status EQ 'Y'.
      <fs_cu>-order_status = icon_led_green.
      <fs_cu>-order_possible = icon_system_help.
    ELSEIF <fs_cu>-so_status EQ 'F'.
      <fs_cu>-so_status = icon_led_red.
    ENDIF.
  ENDLOOP.
*
*-- Set Travel Agency Status
  LOOP AT gt_ta ASSIGNING FIELD-SYMBOL(<fs_ta>).
    IF <fs_ta>-so_status EQ 'N'.
      <fs_ta>-order_status = icon_led_red.
    ELSEIF <fs_ta>-so_status EQ 'Y'.
      <fs_ta>-order_status = icon_led_green.
      <fs_ta>-order_possible = icon_system_help.
    ELSEIF <fs_ta>-so_status EQ 'F'.
      <fs_ta>-so_status = icon_led_red.
    ENDIF.
  ENDLOOP.

*-- Set Contracted Carrier Status
  LOOP AT gt_cc ASSIGNING FIELD-SYMBOL(<fs_cc>).
    IF <fs_cc>-so_status EQ 'N'.
      <fs_cc>-order_status = icon_led_red.
    ELSEIF <fs_cc>-so_status EQ 'Y'.
      <fs_cc>-order_status = icon_led_green.
      <fs_cc>-order_possible = icon_system_help.
    ELSEIF <fs_cc>-so_status EQ 'F'.
      <fs_cc>-so_status = icon_led_red.
    ENDIF.
  ENDLOOP.

*-- Set Non-Contracted Carrier Status
  LOOP AT gt_nc ASSIGNING FIELD-SYMBOL(<fs_nc>).
    IF <fs_nc>-so_status EQ 'N'.
      <fs_nc>-order_status = icon_led_red.
    ELSEIF <fs_nc>-so_status EQ 'Y'.
      <fs_nc>-order_status = icon_led_green.
      <fs_nc>-order_possible = icon_system_help.
    ELSEIF <fs_nc>-so_status EQ 'F'.
      <fs_nc>-so_status = icon_led_red.
    ENDIF.
  ENDLOOP.

  UNASSIGN : <fs_cu>, <fs_ta>, <fs_cc>, <fs_nc>.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_date
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_date .

*-- Set pa_date
  pa_date = sy-datum.

ENDFORM.
*&---------------------------------------------------------------------*
*& Module BEFORE_100_SCREEN OUTPUT
*&---------------------------------------------------------------------*
*&
*&---------------------------------------------------------------------*
MODULE before_100_screen OUTPUT.

  PERFORM set_so_status.
  PERFORM display_100_screen.

ENDMODULE.
*&---------------------------------------------------------------------*
*& Form set_so_status
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_so_status .

  DATA : lt_soc LIKE TABLE OF gs_soc.

  CLEAR : gv_csoy, gv_cson, gv_csof.

*-- Get Data(gt_soc, lt_soc)
  SELECT input_head, MIN( input_line ) AS input_line
    FROM zc103_cds_idata
    WHERE input_date EQ @pa_date
    GROUP BY input_head
    INTO CORRESPONDING FIELDS OF TABLE @gt_soc.

  SELECT input_head, input_line, so_status
    FROM zc103_cds_idata
    WHERE input_date EQ @pa_date
    INTO CORRESPONDING FIELDS OF TABLE @lt_soc.

*-- Patch so_status Data
  SORT : lt_soc BY input_head ASCENDING.
  LOOP AT gt_soc ASSIGNING FIELD-SYMBOL(<fs_soc>).
    READ TABLE lt_soc INTO DATA(ls_soc) WITH KEY input_head = <fs_soc>-input_head
                                                 input_line = <fs_soc>-input_line
                                        BINARY SEARCH.
    <fs_soc>-so_status = ls_soc-so_status.
  ENDLOOP.

  UNASSIGN : <fs_soc>.

*-- Count SO Status
  LOOP AT gt_soc INTO gs_soc.
    IF ( gs_soc-so_status EQ 'Y' ).
      gv_csoy += 1.
    ELSEIF ( gs_soc-so_status EQ 'N' ).
      gv_cson += 1.
    ELSEIF ( gs_soc-so_status EQ 'F' ).
      gv_csof += 1.
    ENDIF.
  ENDLOOP.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form display_100_screen
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM display_100_screen .

  READ TABLE gt_hdisplay INTO gs_hdisplay INDEX 1.

*-- Set Field Catalog by order type(Header)
  CLEAR : gt_brtfcat, gt_brbfcat.
  IF ( gs_hdisplay-order_type EQ '여행사' ) OR
     ( gs_hdisplay-order_type EQ '계약 화물사' ) OR
     ( gs_hdisplay-order_type EQ '미계약 화물사' ).
    PERFORM set_100_head_field_catalog USING : 'X' 'ORDERID' 'ZC103SDT0006' ' ' ' ',
                                          ' ' 'BPID' 'ZC103SDT0006' ' ' ' ',
                                          ' ' 'CONDITIONID' 'ZC103SDT0006' ' ' ' ',
                                          ' ' 'ORDER_DATE' 'ZC103SDT0006' ' ' ' ',
                                          ' ' 'CANCEL_DEADLINE' 'ZC103SDT0006' ' ' ' ',
                                          ' ' 'ORDER_TYPE' 'ZC103SDT0006' 'C' 'X',
                                          ' ' 'TOTAL_AMOUNT' 'ZC103SDT0006' ' ' ' ',
                                          ' ' 'CURRENCY' 'ZC103SDT0006' ' ' ' ',
                                          ' ' 'ORDER_STATUS' 'ZC103SDT0006' 'C' 'X',
                                          ' ' 'BILLING_STATUS' 'ZC103SDT0006' 'C' 'X',
                                          ' ' 'SRV_END_STATUS' 'ZC103SDT0006' 'C' 'X'.
  ELSEIF ( gs_hdisplay-order_type EQ '일반 고객' ).
    PERFORM set_100_head_field_catalog USING : 'X' 'ORDERID' 'ZC103SDT0006' ' ' ' ',
                                          ' ' 'CUSTID' 'ZC103SDT0006' ' ' ' ',
                                          ' ' 'CONDITIONID' 'ZC103SDT0006' ' ' ' ',
                                          ' ' 'ORDER_DATE' 'ZC103SDT0006' ' ' ' ',
                                          ' ' 'CANCEL_DEADLINE' 'ZC103SDT0006' ' ' ' ',
                                          ' ' 'ORDER_TYPE' 'ZC103SDT0006' 'C' 'X',
                                          ' ' 'TOTAL_AMOUNT' 'ZC103SDT0006' ' ' ' ',
                                          ' ' 'CURRENCY' 'ZC103SDT0006' ' ' ' ',
                                          ' ' 'ORDER_STATUS' 'ZC103SDT0006' 'C' 'X',
                                          ' ' 'SRV_END_STATUS' 'ZC103SDT0006' 'C' 'X'.
  ELSE.
    PERFORM set_100_head_field_catalog USING : 'X' 'ORDERID' 'ZC103SDT0006' ' ' ' ',
                                          ' ' 'BPID' 'ZC103SDT0006' ' ' ' ',
                                          ' ' 'CUSTID' 'ZC103SDT0006' ' ' ' ',
                                          ' ' 'CONDITIONID' 'ZC103SDT0006' ' ' ' ',
                                          ' ' 'ORDER_DATE' 'ZC103SDT0006' ' ' ' ',
                                          ' ' 'CANCEL_DEADLINE' 'ZC103SDT0006' ' ' ' ',
                                          ' ' 'ORDER_TYPE' 'ZC103SDT0006' 'C' 'X',
                                          ' ' 'TOTAL_AMOUNT' 'ZC103SDT0006' ' ' ' ',
                                          ' ' 'CURRENCY' 'ZC103SDT0006' ' ' ' ',
                                          ' ' 'ORDER_STATUS' 'ZC103SDT0006' 'C' 'X',
                                          ' ' 'SRV_END_STATUS' 'ZC103SDT0006' 'C' 'X'.
  ENDIF.

*-- Set Field Catalog by order type(Line)
  IF ( gs_hdisplay-order_type EQ '여행사' ).
    PERFORM set_100_line_field_catalog USING : 'X' 'ORDERID' 'ZC103SDT0007' ' ' ' ',
                                               'X' 'ORDERITEMNO' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'BOOKINGID' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'CHARGED_ITEM' 'ZC103SDT0007' 'C' 'X',
                                               ' ' 'DESCRIPTION' 'ZC103SDT0007' 'C' 'X',
                                               ' ' 'TICKET_QUANTITY' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'TICKET_UNIT' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'UNIT_PRICE' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'TAX_AMOUNT' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'DISCOUNT' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'CURRENCY' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'USED_MILEAGE' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'ORDER_STATUS' 'ZC103SDT0007' 'C' 'X',
                                               ' ' 'SRV_END_STATUS' 'ZC103SDT0007' 'C' 'X'.
  ELSEIF ( gs_hdisplay-order_type EQ '계약 화물사' ) OR
         ( gs_hdisplay-order_type EQ '미계약 화물사' ).
    PERFORM set_100_line_field_catalog USING : 'X' 'ORDERID' 'ZC103SDT0007' ' ' ' ',
                                               'X' 'ORDERITEMNO' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'TRANSPORTID' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'CHARGED_ITEM' 'ZC103SDT0007' 'C' 'X',
                                               ' ' 'DESCRIPTION' 'ZC103SDT0007' 'C' 'X',
                                               ' ' 'CARGO_WEIGHT' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'CARGO_UNIT' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'UNIT_PRICE' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'TAX_AMOUNT' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'DISCOUNT' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'CURRENCY' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'USED_MILEAGE' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'ORDER_STATUS' 'ZC103SDT0007' 'C' 'X',
                                               ' ' 'SRV_END_STATUS' 'ZC103SDT0007' 'C' 'X'.
  ELSEIF ( gs_hdisplay-order_type EQ '일반 고객' ).
    PERFORM set_100_line_field_catalog USING : 'X' 'ORDERID' 'ZC103SDT0007' ' ' ' ',
                                               'X' 'ORDERITEMNO' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'BOOKINGID' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'CHARGED_ITEM' 'ZC103SDT0007' 'C' 'X',
                                               ' ' 'DESCRIPTION' 'ZC103SDT0007' 'C' 'X',
                                               ' ' 'TICKET_QUANTITY' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'TICKET_UNIT' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'UNIT_PRICE' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'TAX_AMOUNT' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'DISCOUNT' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'CURRENCY' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'USED_MILEAGE' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'ORDER_STATUS' 'ZC103SDT0007' 'C' 'X',
                                               ' ' 'SRV_END_STATUS' 'ZC103SDT0007' 'C' 'X'.
  ELSE.
    PERFORM set_100_line_field_catalog USING : 'X' 'ORDERID' 'ZC103SDT0007' ' ' ' ',
                                               'X' 'ORDERITEMNO' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'BOOKINGID' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'TRANSPORTID' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'CHARGED_ITEM' 'ZC103SDT0007' 'C' 'X',
                                               ' ' 'DESCRIPTION' 'ZC103SDT0007' 'C' 'X',
                                               ' ' 'CARGO_WEIGHT' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'CARGO_UNIT' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'UNIT_PRICE' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'TAX_AMOUNT' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'DISCOUNT' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'CURRENCY' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'USED_MILEAGE' 'ZC103SDT0007' ' ' ' ',
                                               ' ' 'ORDER_STATUS' 'ZC103SDT0007' 'C' 'X',
                                               ' ' 'SRV_END_STATUS' 'ZC103SDT0007' 'C' 'X'.
  ENDIF.

  IF go_bright_container IS INITIAL.

    PERFORM set_100_layout.
    PERFORM create_100_object.
    PERFORM exclude_100_toolbar.

*-- Set handler 추가 필요
  ENDIF.

*-- Display Head ALV
  CALL METHOD go_brtop_alv_grid->set_table_for_first_display
    EXPORTING
      is_variant           = gs_brtvariant
      i_save               = 'A'
      i_default            = 'X'
      is_layout            = gs_brtlayout
      it_toolbar_excluding = gt_ui_functions
    CHANGING
      it_outtab            = gt_hdisplay
      it_fieldcatalog      = gt_brtfcat.

*-- Display Line ALV
  CALL METHOD go_brbottom_alv_grid->set_table_for_first_display
    EXPORTING
      is_variant           = gs_brbvariant
      i_save               = 'A'
      i_default            = 'X'
      is_layout            = gs_brblayout
      it_toolbar_excluding = gt_ui_functions
    CHANGING
      it_outtab            = gt_ldisplay
      it_fieldcatalog      = gt_brbfcat.

  PERFORM refresh_brtop_table.
  PERFORM refresh_brbottom_table.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_100_field_catalog
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> P_
*&      --> P_
*&      --> P_
*&      --> P_
*&      --> P_
*&---------------------------------------------------------------------*
FORM set_100_head_field_catalog  USING pv_key pv_field pv_table pv_just pv_emph.

  gs_brtfcat-key = pv_key.
  gs_brtfcat-fieldname = pv_field.
  gs_brtfcat-ref_table = pv_table.
  gs_brtfcat-just = pv_just.
  gs_brtfcat-emphasize = pv_emph.

  CASE pv_field.
    WHEN 'TOTAL_AMOUNT'.
      gs_brtfcat-cfieldname = 'CURRENCY'.
    WHEN 'CURRENCY'.
      gs_brtfcat-coltext = '통화'.
  ENDCASE.

  APPEND gs_brtfcat TO gt_brtfcat.
  CLEAR : gs_brtfcat.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_100_line_field_catalog
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> P_
*&      --> P_
*&      --> P_
*&      --> P_
*&      --> P_
*&---------------------------------------------------------------------*
FORM set_100_line_field_catalog  USING pv_key pv_field pv_table pv_just pv_emph.

  gs_brbfcat-key = pv_key.
  gs_brbfcat-fieldname = pv_field.
  gs_brbfcat-ref_table = pv_table.
  gs_brbfcat-just = pv_just.
  gs_brbfcat-emphasize = pv_emph.

  CASE pv_field.
    WHEN 'TICKET_QUANTITY'.
      gs_brbfcat-qfieldname = 'TICKET_UNIT'.
    WHEN 'CARGO_WEIGHT'.
      gs_brbfcat-qfieldname = 'CARGO_UNIT'.
    WHEN 'UNIT_PRICE'.
      gs_brbfcat-cfieldname = 'CURRENCY'.
    WHEN 'TAX_AMOUNT'.
      gs_brbfcat-cfieldname = 'CURRENCY'.
    WHEN 'DISCOUNT'.
      gs_brbfcat-cfieldname = 'CURRENCY'.
    WHEN 'USED_MILEAGE'.
      gs_brbfcat-cfieldname = 'CURRENCY'.
    WHEN 'CURRENCY'.
      gs_brbfcat-coltext = '통화'.
  ENDCASE.

  APPEND gs_brbfcat TO gt_brbfcat.
  CLEAR : gs_brbfcat.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_100_layout
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_100_layout .

*-- For Header Layout
  gs_brtlayout-zebra = abap_true.
  gs_brtlayout-cwidth_opt = 'A'.

*-- For Line Layout
  gs_brblayout-zebra = abap_true.
  gs_brblayout-cwidth_opt = 'A'.

*-- For Header Variant
  gs_brtvariant-report = sy-repid.
  gs_brtvariant-handle = 'ALV1'.

*-- For Line Variant
  gs_brbvariant-report = sy-repid.
  gs_brtvariant-handle = 'ALV2'.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form create_100_object
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM create_100_object .

*-- Bottom Right Container
  CREATE OBJECT go_bright_container
    EXPORTING
      container_name = 'BRIGHT_CONT'.

*-- Split Container
  CREATE OBJECT go_brsplit_container
    EXPORTING
      parent  = go_bright_container
      rows    = 2
      columns = 1.

*-- Patch Container : Top Container
  CALL METHOD go_brsplit_container->get_container
    EXPORTING
      row       = 1
      column    = 1
    RECEIVING
      container = go_brtop_container.

*-- Patch Container : Bottom Container
  CALL METHOD go_brsplit_container->get_container
    EXPORTING
      row       = 2
      column    = 1
    RECEIVING
      container = go_brbottom_container.

*-- Patch ALV : Top ALV
  CREATE OBJECT go_brtop_alv_grid
    EXPORTING
      i_parent = go_brtop_container.

*-- Patch ALV : Bottom ALV
  CREATE OBJECT go_brbottom_alv_grid
    EXPORTING
      i_parent = go_brbottom_container.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form exclude_100_toolbar
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM exclude_100_toolbar .

  DATA : ls_ui_functions TYPE ui_func.

  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_undo.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_copy.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_copy_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_cut.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_delete_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_insert_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_append_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_paste.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_paste_new_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_refresh.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_auf.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_average.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_print.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_graph.
  APPEND ls_ui_functions TO gt_ui_functions.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form refresh_brtop_table
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM refresh_brtop_table .

  DATA : ls_stable TYPE lvc_s_stbl.

  ls_stable-row = abap_true.
  ls_stable-col = abap_true.

  CALL METHOD go_brtop_alv_grid->refresh_table_display
    EXPORTING
      is_stable = ls_stable.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form refresh_brbottom_table
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM refresh_brbottom_table .

  DATA : ls_stable TYPE lvc_s_stbl.

  ls_stable-row = abap_true.
  ls_stable-col = abap_true.

  CALL METHOD go_brbottom_alv_grid->refresh_table_display
    EXPORTING
      is_stable = ls_stable.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_subscreen
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_subscreen .

*-- Set Subscreen Number
  CASE gc_tab-activetab.
    WHEN 'TAB1'.
      gv_subscreen = '0101'.
    WHEN 'TAB2'.
      gv_subscreen = '0102'.
    WHEN 'TAB3'.
      gv_subscreen = '0103'.
    WHEN 'TAB4'.
      gv_subscreen = '0104'.
    WHEN OTHERS.
      gc_tab-activetab = 'TAB1'.
      gv_subscreen = '0101'.
  ENDCASE.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form display_101_screen
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM display_101_screen .

  IF go_101_container IS INITIAL.

    PERFORM set_101_field_catalog USING : 'X' 'ORDER_POSSIBLE' ' ' 'C' 'X',
                                          'X' 'ORDER_STATUS' ' ' 'C' 'X',
                                          'X' 'INPUT_HEAD' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'INPUT_TYPE' 'ZC103_CDS_IDATA' 'C' 'X',
                                          ' ' 'CUSTID' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'COUNTRYFROM' 'ZC103_CDS_IDATA' 'C' 'X',
                                          ' ' 'COUNTRYTO' 'ZC103_CDS_IDATA' 'C' 'X',
                                          ' ' 'FLIGHTID' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'SCHEDULEID' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'CONDITIONID' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'CURRENCY' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'TOTAL_PRICE' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'INPUT_DATE' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'ORDERID' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'SO_STATUS' 'ZC103_CDS_IDATA' 'C' 'X',
                                          ' ' 'TICKET_QUANTITY' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'TICKET_UNIT' 'ZC103_CDS_IDATA' ' ' ' '.

    PERFORM create_101_object.
    PERFORM set_101_layout_variant.
    PERFORM exclude_101_toolbar.

    SET HANDLER : lcl_event_handler=>cu_edit_toolbar FOR go_101_alv_grid,
                  lcl_event_handler=>user_command FOR go_101_alv_grid,
                  lcl_event_handler=>cu_double_click FOR go_101_alv_grid.

*-- Display Customer ALV
    CALL METHOD go_101_alv_grid->set_table_for_first_display
      EXPORTING
        is_variant           = gs_101_variant
        i_save               = 'A'
        i_default            = 'X'
        is_layout            = gs_101_layout
        it_toolbar_excluding = gt_ui_functions
      CHANGING
        it_outtab            = gt_cudisplay
        it_fieldcatalog      = gt_101_fcat.

  ENDIF.

  PERFORM refresh_cu_table.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_display_data
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_display_data .
  DATA : lv_total_price     TYPE wrbtr,
         lv_ticket_quantity TYPE zc103sdt0011-totalticket.

  DATA : lt_head     TYPE TABLE OF zc103_cds_idata,
         lt_all_data TYPE TABLE OF zc103_cds_idata.

*-- Get All Data
  SELECT input_head, input_line, input_type, bpid, custid, unrg_custname, unrg_custemail,
         matid, countryfrom, countryto,flightid, scheduleid, conditionid, currency,
         unit_price, total_price, input_date, header_status, orderid, so_status,
         class, used_mileage, ticket_quantity, ticket_unit, meal_type, souvenir_qty,
         souvenir_unit, weight, weight_unit, volume, erdat, ernam, erzet, aenam, aedat, aezet
    FROM zc103_cds_idata
    WHERE so_status EQ 'N'
      AND input_date EQ @pa_date
    INTO CORRESPONDING FIELDS OF TABLE @lt_all_data.

*-- Group by Head
  SELECT input_head, MIN( input_line ) AS input_line, SUM( total_price ) AS total_price
    FROM zc103_cds_idata
    WHERE so_status EQ 'N'
      AND input_date EQ @pa_date
    GROUP BY input_head
    INTO CORRESPONDING FIELDS OF TABLE @lt_head.

*-- Patch Input_type
  SORT : lt_all_data BY input_head ASCENDING.
  LOOP AT lt_head ASSIGNING FIELD-SYMBOL(<fs_head>).
    lv_total_price = <fs_head>-total_price.
    READ TABLE lt_all_data INTO DATA(ls_all_data) WITH KEY input_head = <fs_head>-input_head
                                                  BINARY SEARCH.
    <fs_head> = CORRESPONDING #( ls_all_data ).
    <fs_head>-total_price = lv_total_price.
  ENDLOOP.

  UNASSIGN : <fs_head>.

*-- Move Grouping input_head data
  LOOP AT lt_head INTO DATA(ls_head).
    CASE ls_head-input_type.
      WHEN 'CU'.
        gs_cudisplay = CORRESPONDING #( ls_head ).
        gs_cudisplay-order_status = icon_led_red.
*-- Check so_status
        IF ( gs_cudisplay-so_status EQ 'F' ).
          gs_cudisplay-order_possible = icon_incomplete.
        ELSE.
          gs_cudisplay-order_possible = icon_system_help.
        ENDIF.
        APPEND gs_cudisplay TO gt_cudisplay.
      WHEN 'TA'.
        gs_tadisplay = CORRESPONDING #( ls_head ).
        gs_tadisplay-order_status = icon_led_red.
*-- CHECK so_status
        IF ( gs_tadisplay-so_status EQ 'F' ).
          gs_tadisplay-order_possible = icon_incomplete.
        ELSE.
          gs_tadisplay-order_possible = icon_system_help.
        ENDIF.
        APPEND gs_tadisplay TO gt_tadisplay.
      WHEN 'CC'.
        gs_ccdisplay = CORRESPONDING #( ls_head ).
        gs_ccdisplay-order_status = icon_led_red.
*-- CHECK so_status
        IF ( gs_ccdisplay-so_status EQ 'F' ).
          gs_ccdisplay-order_possible = icon_incomplete.
        ELSE.
          gs_ccdisplay-order_possible = icon_system_help.
        ENDIF.
        APPEND gs_ccdisplay TO gt_ccdisplay.
      WHEN 'NC'.
        gs_ncdisplay = CORRESPONDING #( ls_head ).
        gs_ncdisplay-order_status = icon_led_red.
*-- CHECK so_status
        IF ( gs_ncdisplay-so_status EQ 'F' ).
          gs_ncdisplay-order_possible = icon_incomplete.
        ELSE.
          gs_ncdisplay-order_possible = icon_system_help.
        ENDIF.
        APPEND gs_ncdisplay TO gt_ncdisplay.
    ENDCASE.
  ENDLOOP.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_head_value_to_text
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_head_value_to_text.

*-- Change gt_cudisplay Value field to Text
  LOOP AT gt_cudisplay ASSIGNING FIELD-SYMBOL(<fs_cu>).
    IF ( <fs_cu>-so_status EQ 'Y' ).
      <fs_cu>-order_status = icon_led_green.
      <fs_cu>-order_possible = icon_checked.
    ELSEIF ( <fs_cu>-so_status EQ 'N' ).
      <fs_cu>-order_status = icon_led_red.
    ELSEIF ( <fs_cu>-so_status EQ 'F' ).
      <fs_cu>-order_possible = icon_incomplete.
    ENDIF.

*-- Input_type
    CASE <fs_cu>-input_type.
      WHEN 'CU'.
        <fs_cu>-input_type = '일반 고객(B2C)'.
      WHEN 'CC'.
        <fs_cu>-input_type = '계약 화물사(B2B)'.
      WHEN 'NC'.
        <fs_cu>-input_type = '미계약 화물사(B2B)'.
      WHEN 'TA'.
        <fs_cu>-input_type = '여행사(B2B)'.
    ENDCASE.

*-- Countryfrom
    CASE <fs_cu>-countryfrom.
      WHEN '00'.
        <fs_cu>-countryfrom = '대한민국(인천)'.
      WHEN '01'.
        <fs_cu>-countryfrom = '대한민국(부산/김해)'.
      WHEN '02'.
        <fs_cu>-countryfrom = '오스트레일리아(시드니)'.
      WHEN '03'.
        <fs_cu>-countryfrom = '베트남(하노이)'.
      WHEN '04'.
        <fs_cu>-countryfrom = '아랍에미리트(두바이)'.
      WHEN '05'.
        <fs_cu>-countryfrom = '독일(프랑크푸르트)'.
      WHEN '06'.
        <fs_cu>-countryfrom = '미국(LA)'.
    ENDCASE.

*-- Countryto
    CASE <fs_cu>-countryto.
      WHEN '00'.
        <fs_cu>-countryto = '대한민국(인천)'.
      WHEN '01'.
        <fs_cu>-countryto = '대한민국(부산/김해)'.
      WHEN '02'.
        <fs_cu>-countryto = '오스트레일리아(시드니)'.
      WHEN '03'.
        <fs_cu>-countryto = '베트남(하노이)'.
      WHEN '04'.
        <fs_cu>-countryto = '아랍에미리트(두바이)'.
      WHEN '05'.
        <fs_cu>-countryto = '독일(프랑크푸르트)'.
      WHEN '06'.
        <fs_cu>-countryto = '미국(LA)'.
    ENDCASE.

*-- so_status
    CASE <fs_cu>-so_status.
      WHEN 'Y'.
        <fs_cu>-so_status = '판매오더 전환 완료'.
      WHEN 'N'.
        <fs_cu>-so_status = '판매오더 전환 미완료'.
      WHEN 'F'.
        <fs_cu>-so_status = '유효성 검사 실패'.
    ENDCASE.
  ENDLOOP.

  UNASSIGN : <fs_cu>.

*-- Change gt_tadisplay Value FIELD to Text
  LOOP AT gt_tadisplay ASSIGNING FIELD-SYMBOL(<fs_ta>).
    IF ( <fs_ta>-so_status EQ 'Y' ).
      <fs_ta>-order_status = icon_led_green.
      <fs_ta>-order_possible = icon_checked.
    ELSEIF ( <fs_ta>-so_status EQ 'N' ).
      <fs_ta>-order_status = icon_led_red.
    ELSEIF ( <fs_ta>-so_status EQ 'F' ).
      <fs_ta>-order_possible = icon_incomplete.
    ENDIF.

*-- Input_type
    CASE <fs_ta>-input_type.
      WHEN 'CU'.
        <fs_ta>-input_type = '일반 고객(B2C)'.
      WHEN 'CC'.
        <fs_ta>-input_type = '계약 화물사(B2B)'.
      WHEN 'NC'.
        <fs_ta>-input_type = '미계약 화물사(B2B)'.
      WHEN 'TA'.
        <fs_ta>-input_type = '여행사(B2B)'.
    ENDCASE.

*-- Countryfrom
    CASE <fs_ta>-countryfrom.
      WHEN '00'.
        <fs_ta>-countryfrom = '대한민국(인천)'.
      WHEN '01'.
        <fs_ta>-countryfrom = '대한민국(부산/김해)'.
      WHEN '02'.
        <fs_ta>-countryfrom = '오스트레일리아(시드니)'.
      WHEN '03'.
        <fs_ta>-countryfrom = '베트남(하노이)'.
      WHEN '04'.
        <fs_ta>-countryfrom = '아랍에미리트(두바이)'.
      WHEN '05'.
        <fs_ta>-countryfrom = '독일(프랑크푸르트)'.
      WHEN '06'.
        <fs_ta>-countryfrom = '미국(LA)'.
    ENDCASE.

*-- Countryto
    CASE <fs_ta>-countryto.
      WHEN '00'.
        <fs_ta>-countryto = '대한민국(인천)'.
      WHEN '01'.
        <fs_ta>-countryto = '대한민국(부산/김해)'.
      WHEN '02'.
        <fs_ta>-countryto = '오스트레일리아(시드니)'.
      WHEN '03'.
        <fs_ta>-countryto = '베트남(하노이)'.
      WHEN '04'.
        <fs_ta>-countryto = '아랍에미리트(두바이)'.
      WHEN '05'.
        <fs_ta>-countryto = '독일(프랑크푸르트)'.
      WHEN '06'.
        <fs_ta>-countryto = '미국(LA)'.
    ENDCASE.

*-- so_status
    CASE <fs_ta>-so_status.
      WHEN 'Y'.
        <fs_ta>-so_status = '판매오더 전환 완료'.
      WHEN 'N'.
        <fs_ta>-so_status = '판매오더 전환 미완료'.
      WHEN 'F'.
        <fs_ta>-so_status = '유효성 검사 실패'.
    ENDCASE.
  ENDLOOP.

  UNASSIGN : <fs_ta>.

*-- Change gt_ccdisplay Value FIELD to Text
  LOOP AT gt_ccdisplay ASSIGNING FIELD-SYMBOL(<fs_cc>).
    IF ( <fs_cc>-so_status EQ 'Y' ).
      <fs_cc>-order_status = icon_led_green.
      <fs_cc>-order_possible = icon_checked.
    ELSEIF ( <fs_cc>-so_status EQ 'N' ).
      <fs_cc>-order_status = icon_led_red.
    ELSEIF ( <fs_cc>-so_status EQ 'F' ).
      <fs_cc>-order_possible = icon_incomplete.
    ENDIF.

*-- Input_type
    CASE <fs_cc>-input_type.
      WHEN 'CU'.
        <fs_cc>-input_type = '일반 고객(B2C)'.
      WHEN 'CC'.
        <fs_cc>-input_type = '계약 화물사(B2B)'.
      WHEN 'NC'.
        <fs_cc>-input_type = '미계약 화물사(B2B)'.
      WHEN 'TA'.
        <fs_cc>-input_type = '여행사(B2B)'.
    ENDCASE.

*-- Countryfrom
    CASE <fs_cc>-countryfrom.
      WHEN '00'.
        <fs_cc>-countryfrom = '대한민국(인천)'.
      WHEN '01'.
        <fs_cc>-countryfrom = '대한민국(부산/김해)'.
      WHEN '02'.
        <fs_cc>-countryfrom = '오스트레일리아(시드니)'.
      WHEN '03'.
        <fs_cc>-countryfrom = '베트남(하노이)'.
      WHEN '04'.
        <fs_cc>-countryfrom = '아랍에미리트(두바이)'.
      WHEN '05'.
        <fs_cc>-countryfrom = '독일(프랑크푸르트)'.
      WHEN '06'.
        <fs_cc>-countryfrom = '미국(LA)'.
    ENDCASE.

*-- Countryto
    CASE <fs_cc>-countryto.
      WHEN '00'.
        <fs_cc>-countryto = '대한민국(인천)'.
      WHEN '01'.
        <fs_cc>-countryto = '대한민국(부산/김해)'.
      WHEN '02'.
        <fs_cc>-countryto = '오스트레일리아(시드니)'.
      WHEN '03'.
        <fs_cc>-countryto = '베트남(하노이)'.
      WHEN '04'.
        <fs_cc>-countryto = '아랍에미리트(두바이)'.
      WHEN '05'.
        <fs_cc>-countryto = '독일(프랑크푸르트)'.
      WHEN '06'.
        <fs_cc>-countryto = '미국(LA)'.
    ENDCASE.

*-- so_status
    CASE <fs_cc>-so_status.
      WHEN 'Y'.
        <fs_cc>-so_status = '판매오더 전환 완료'.
      WHEN 'N'.
        <fs_cc>-so_status = '판매오더 전환 미완료'.
      WHEN 'F'.
        <fs_cc>-so_status = '유효성 검사 실패'.
    ENDCASE.
  ENDLOOP.

  UNASSIGN : <fs_cc>.

*-- Change gt_ccdisplay Value FIELD to Text
  LOOP AT gt_ncdisplay ASSIGNING FIELD-SYMBOL(<fs_nc>).
    IF ( <fs_nc>-so_status EQ 'Y' ).
      <fs_nc>-order_status = icon_led_green.
      <fs_nc>-order_possible = icon_checked.
    ELSEIF ( <fs_nc>-so_status EQ 'N' ).
      <fs_nc>-order_status = icon_led_red.
    ELSEIF ( <fs_nc>-so_status EQ 'F' ).
      <fs_nc>-order_possible = icon_incomplete.
    ENDIF.

*-- Input_type
    CASE <fs_nc>-input_type.
      WHEN 'CU'.
        <fs_nc>-input_type = '일반 고객(B2C)'.
      WHEN 'CC'.
        <fs_nc>-input_type = '계약 화물사(B2B)'.
      WHEN 'NC'.
        <fs_nc>-input_type = '미계약 화물사(B2B)'.
      WHEN 'TA'.
        <fs_nc>-input_type = '여행사(B2B)'.
    ENDCASE.

*-- Countryfrom
    CASE <fs_nc>-countryfrom.
      WHEN '00'.
        <fs_nc>-countryfrom = '대한민국(인천)'.
      WHEN '01'.
        <fs_nc>-countryfrom = '대한민국(부산/김해)'.
      WHEN '02'.
        <fs_nc>-countryfrom = '오스트레일리아(시드니)'.
      WHEN '03'.
        <fs_nc>-countryfrom = '베트남(하노이)'.
      WHEN '04'.
        <fs_nc>-countryfrom = '아랍에미리트(두바이)'.
      WHEN '05'.
        <fs_nc>-countryfrom = '독일(프랑크푸르트)'.
      WHEN '06'.
        <fs_nc>-countryfrom = '미국(LA)'.
    ENDCASE.

*-- Countryto
    CASE <fs_nc>-countryto.
      WHEN '00'.
        <fs_nc>-countryto = '대한민국(인천)'.
      WHEN '01'.
        <fs_nc>-countryto = '대한민국(부산/김해)'.
      WHEN '02'.
        <fs_nc>-countryto = '오스트레일리아(시드니)'.
      WHEN '03'.
        <fs_nc>-countryto = '베트남(하노이)'.
      WHEN '04'.
        <fs_nc>-countryto = '아랍에미리트(두바이)'.
      WHEN '05'.
        <fs_nc>-countryto = '독일(프랑크푸르트)'.
      WHEN '06'.
        <fs_nc>-countryto = '미국(LA)'.
    ENDCASE.

*-- so_status
    CASE <fs_nc>-so_status.
      WHEN 'Y'.
        <fs_nc>-so_status = '판매오더 전환 완료'.
      WHEN 'N'.
        <fs_nc>-so_status = '판매오더 전환 미완료'.
      WHEN 'F'.
        <fs_nc>-so_status = '유효성 검사 실패'.
    ENDCASE.
  ENDLOOP.

  UNASSIGN : <fs_nc>.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_101_field_catalog
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> P_
*&      --> P_
*&      --> P_
*&      --> P_
*&      --> P_
*&---------------------------------------------------------------------*
FORM set_101_field_catalog  USING pv_key pv_field pv_table pv_just pv_emph.

  gs_101_fcat-key = pv_key.
  gs_101_fcat-fieldname = pv_field.
  gs_101_fcat-ref_table = pv_table.
  gs_101_fcat-just = pv_just.
  gs_101_fcat-emphasize = pv_emph.

  CASE pv_field.
    WHEN 'ORDER_POSSIBLE'.
      gs_101_fcat-coltext = '유효성 여부'.
    WHEN 'ORDER_STATUS'.
      gs_101_fcat-coltext = '판매오더 전환 상태'.
    WHEN 'TOTAL_PRICE'.
      gs_101_fcat-cfieldname = 'CURRENCY'.
    WHEN 'TICKET_QUANTITY'.
      gs_101_fcat-qfieldname = 'TICKET_UNIT'.
  ENDCASE.

  APPEND gs_101_fcat TO gt_101_fcat.
  CLEAR : gs_101_fcat.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form create_101_object
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM create_101_object .

  CREATE OBJECT go_101_container
    EXPORTING
      container_name = '101_CONT'.

  CREATE OBJECT go_101_alv_grid
    EXPORTING
      i_parent = go_101_container.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_101_layout_variant
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_101_layout_variant .

*-- Set 101 layout
  gs_101_layout-zebra = abap_true.
  gs_101_layout-cwidth_opt = 'A'.
  gs_101_layout-sel_mode = 'D'.

*-- Set 101 variant
  gs_101_variant-report = sy-repid.
  gs_101_variant-handle = 'SUB1'.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form exclude_101_toolbar
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM exclude_101_toolbar .

  DATA : ls_ui_functions TYPE ui_func.

  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_undo.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_copy.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_copy_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_cut.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_delete_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_insert_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_append_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_paste.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_paste_new_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_refresh.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_auf.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_average.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_print.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_graph.
  APPEND ls_ui_functions TO gt_ui_functions.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form refresh_cu_table
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM refresh_cu_table .

  DATA : ls_stable TYPE lvc_s_stbl.

  ls_stable-row = abap_true.
  ls_stable-col = abap_true.

  CALL METHOD go_101_alv_grid->refresh_table_display
    EXPORTING
      is_stable = ls_stable.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_102_field_catalog
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> P_
*&      --> P_
*&      --> P_
*&      --> P_
*&      --> P_
*&---------------------------------------------------------------------*
FORM set_102_field_catalog  USING pv_key pv_field pv_table pv_just pv_emph.

  gs_102_fcat-key = pv_key.
  gs_102_fcat-fieldname = pv_field.
  gs_102_fcat-ref_table = pv_table.
  gs_102_fcat-just = pv_just.
  gs_102_fcat-emphasize = pv_emph.

  CASE pv_field.
    WHEN 'ORDER_POSSIBLE'.
      gs_102_fcat-coltext = '유효성 여부'.
    WHEN 'TOTAL_PRICE'.
      gs_102_fcat-cfieldname = 'CURRENCY'.
    WHEN 'ORDER_STATUS'.
      gs_102_fcat-coltext = '판매오더 전환 상태'.
    WHEN 'TICKET_QUANTITY'.
      gs_102_fcat-qfieldname = 'TICKET_UNIT'.
  ENDCASE.

  APPEND gs_102_fcat TO gt_102_fcat.
  CLEAR : gs_102_fcat.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form create_102_object
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM create_102_object .

  CREATE OBJECT go_102_container
    EXPORTING
      container_name = '102_CONT'.

  CREATE OBJECT go_102_alv_grid
    EXPORTING
      i_parent = go_102_container.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_102_layout_variant
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_102_layout_variant .

*-- Set 102 layout
  gs_102_layout-zebra = abap_true.
  gs_102_layout-cwidth_opt = 'A'.
  gs_102_layout-sel_mode = 'D'.

*-- Set 102 variant
  gs_102_variant-report = sy-repid.
  gs_102_variant-handle = 'SUB2'.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form exclude_102_toolbar
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM exclude_102_toolbar .

  DATA : ls_ui_functions TYPE ui_func.

  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_undo.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_copy.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_copy_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_cut.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_delete_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_insert_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_append_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_paste.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_paste_new_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_refresh.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_auf.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_average.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_print.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_graph.
  APPEND ls_ui_functions TO gt_ui_functions.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form refresh_ta_table
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM refresh_ta_table .

  DATA : ls_stable TYPE lvc_s_stbl.

  ls_stable-row = abap_true.
  ls_stable-col = abap_true.

  CALL METHOD go_102_alv_grid->refresh_table_display
    EXPORTING
      is_stable = ls_stable.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form display_103_screen
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM display_103_screen .

  IF go_103_container IS INITIAL.

    PERFORM set_103_field_catalog USING : 'X' 'ORDER_POSSIBLE' ' ' 'C' 'X',
                                          'X' 'ORDER_STATUS' ' ' 'C' 'X',
                                          'X' 'INPUT_HEAD' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'INPUT_TYPE' 'ZC103_CDS_IDATA' 'C' 'X',
                                          ' ' 'BPID' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'MATID' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'COUNTRYFROM' 'ZC103_CDS_IDATA' 'C' 'X',
                                          ' ' 'COUNTRYTO' 'ZC103_CDS_IDATA' 'C' 'X',
                                          ' ' 'FLIGHTID' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'SCHEDULEID' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'CONDITIONID' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'CURRENCY' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'TOTAL_PRICE' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'INPUT_DATE' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'ORDERID' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'SO_STATUS' 'ZC103_CDS_IDATA' 'C' 'X',
                                          ' ' 'WEIGHT' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'WEIGHT_UNIT' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'VOLUME' 'ZC103_CDS_IDATA' ' ' ' '.

    PERFORM create_103_object.
    PERFORM set_103_layout_variant.
    PERFORM exclude_103_toolbar.

    SET HANDLER : lcl_event_handler=>cc_edit_toolbar FOR go_103_alv_grid,
                  lcl_event_handler=>user_command FOR go_103_alv_grid,
                  lcl_event_handler=>cc_double_click FOR go_103_alv_grid.
*-- Display Contracted Carrier ALV
    CALL METHOD go_103_alv_grid->set_table_for_first_display
      EXPORTING
        is_variant           = gs_103_variant
        i_save               = 'A'
        i_default            = 'X'
        is_layout            = gs_103_layout
        it_toolbar_excluding = gt_ui_functions
      CHANGING
        it_outtab            = gt_ccdisplay
        it_fieldcatalog      = gt_103_fcat.

  ENDIF.

  PERFORM refresh_cc_table.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_103_field_catalog
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> P_
*&      --> P_
*&      --> P_
*&      --> P_
*&      --> P_
*&---------------------------------------------------------------------*
FORM set_103_field_catalog  USING pv_key pv_field pv_table pv_just pv_emph.

  gs_103_fcat-key = pv_key.
  gs_103_fcat-fieldname = pv_field.
  gs_103_fcat-ref_table = pv_table.
  gs_103_fcat-just = pv_just.
  gs_103_fcat-emphasize = pv_emph.

  CASE pv_field.
    WHEN 'ORDER_POSSIBLE'.
      gs_103_fcat-coltext = '유효성 여부'.
    WHEN 'ORDER_STATUS'.
      gs_103_fcat-coltext = '판매오더 전환 상태'.
    WHEN 'TOTAL_PRICE'.
      gs_103_fcat-cfieldname = 'CURRENCY'.
    WHEN 'WEIGHT'.
      gs_103_fcat-qfieldname = 'WEIGHT_UNIT'.
  ENDCASE.

  APPEND gs_103_fcat TO gt_103_fcat.
  CLEAR : gs_103_fcat.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form create_103_object
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM create_103_object .

  CREATE OBJECT go_103_container
    EXPORTING
      container_name = '103_CONT'.

  CREATE OBJECT go_103_alv_grid
    EXPORTING
      i_parent = go_103_container.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_103_layout_variant
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_103_layout_variant .

*-- Set 103 layout
  gs_103_layout-zebra = abap_true.
  gs_103_layout-cwidth_opt = 'A'.
  gs_103_layout-sel_mode = 'D'.

*-- Set 103 variant
  gs_103_variant-report = sy-repid.
  gs_103_variant-handle = 'SUB3'.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form exclude_103_toolbar
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM exclude_103_toolbar .

  DATA : ls_ui_functions TYPE ui_func.

  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_undo.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_copy.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_copy_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_cut.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_delete_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_insert_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_append_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_paste.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_paste_new_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_refresh.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_auf.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_average.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_print.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_graph.
  APPEND ls_ui_functions TO gt_ui_functions.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form refresh_cc_table
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM refresh_cc_table .

  DATA : ls_stable TYPE lvc_s_stbl.

  ls_stable-row = abap_true.
  ls_stable-col = abap_true.

  CALL METHOD go_103_alv_grid->refresh_table_display
    EXPORTING
      is_stable = ls_stable.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form display_104_screen
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM display_104_screen .

  IF go_104_container IS INITIAL.

    PERFORM set_104_field_catalog USING : 'X' 'ORDER_POSSIBLE' ' ' 'C' 'X',
                                          'X' 'ORDER_STATUS' ' ' 'C' ' ',
                                          'X' 'INPUT_HEAD' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'INPUT_TYPE' 'ZC103_CDS_IDATA' 'C' 'X',
                                          ' ' 'BPID' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'MATID' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'COUNTRYFROM' 'ZC103_CDS_IDATA' 'C' 'X',
                                          ' ' 'COUNTRYTO' 'ZC103_CDS_IDATA' 'C' 'X',
                                          ' ' 'FLIGHTID' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'SCHEDULEID' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'CONDITIONID' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'CURRENCY' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'UNIT_PRICE' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'TOTAL_PRICE' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'INPUT_DATE' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'ORDERID' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'SO_STATUS' 'ZC103_CDS_IDATA' 'C' 'X',
                                          ' ' 'WEIGHT' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'WEIGHT_UNIT' 'ZC103_CDS_IDATA' ' ' ' ',
                                          ' ' 'VOLUME' 'ZC103_CDS_IDATA' ' ' ' '.
    PERFORM create_104_object.
    PERFORM set_104_layout_variant.
    PERFORM exclude_104_toolbar.

    SET HANDLER : lcl_event_handler=>nc_edit_toolbar FOR go_104_alv_grid,
                  lcl_event_handler=>user_command FOR go_104_alv_grid,
                  lcl_event_handler=>nc_double_click FOR go_104_alv_grid.

*-- Display Non-Contracted Carrier
    CALL METHOD go_104_alv_grid->set_table_for_first_display
      EXPORTING
        is_variant           = gs_104_variant
        i_save               = 'A'
        i_default            = 'X'
        is_layout            = gs_104_layout
        it_toolbar_excluding = gt_ui_functions
      CHANGING
        it_outtab            = gt_ncdisplay
        it_fieldcatalog      = gt_104_fcat.

  ENDIF.

  PERFORM refresh_nc_table.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_104_field_catalog
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> P_
*&      --> P_
*&      --> P_
*&      --> P_
*&      --> P_
*&---------------------------------------------------------------------*
FORM set_104_field_catalog  USING pv_key pv_field pv_table pv_just pv_emph.

  gs_104_fcat-key = pv_key.
  gs_104_fcat-fieldname = pv_field.
  gs_104_fcat-ref_table = pv_table.
  gs_104_fcat-just = pv_just.
  gs_104_fcat-emphasize = pv_emph.

  CASE pv_field.
    WHEN 'ORDER_POSSIBLE'.
      gs_104_fcat-coltext = '유효성 여부'.
    WHEN 'ORDER_STATUS'.
      gs_104_fcat-coltext = '판매오더 전환 상태'.
    WHEN 'UNIT_PRCIE'.
      gs_104_fcat-cfieldname = 'CURRENCY'.
    WHEN 'TOTAL_PRICE'.
      gs_104_fcat-cfieldname = 'CURRENCY'.
    WHEN 'WEGIHT'.
      gs_104_fcat-qfieldname = 'WEIGHT_UNIT'.
  ENDCASE.

  APPEND gs_104_fcat TO gt_104_fcat.
  CLEAR : gs_104_fcat.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form create_104_object
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM create_104_object .

  CREATE OBJECT go_104_container
    EXPORTING
      container_name = '104_CONT'.

  CREATE OBJECT go_104_alv_grid
    EXPORTING
      i_parent = go_104_container.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_104_layout_variant
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_104_layout_variant .

  gs_104_layout-zebra = abap_true.
  gs_104_layout-cwidth_opt = 'A'.
  gs_104_layout-sel_mode = 'D'.

  gs_104_variant-report = sy-repid.
  gs_104_variant-handle = 'SUB4'.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form exclude_104_toolbar
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM exclude_104_toolbar .

  DATA : ls_ui_functions TYPE ui_func.

  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_undo.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_copy.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_copy_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_cut.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_delete_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_insert_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_append_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_paste.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_paste_new_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_refresh.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_auf.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_average.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_print.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_graph.
  APPEND ls_ui_functions TO gt_ui_functions.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form refresh_nc_table
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM refresh_nc_table .

  DATA : ls_stable TYPE lvc_s_stbl.

  ls_stable-row = abap_true.
  ls_stable-col = abap_true.

  CALL METHOD go_104_alv_grid->refresh_table_display
    EXPORTING
      is_stable = ls_stable.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form edit_toolbar
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> E_OBJECT
*&      --> E_INTERACTIVE
*&---------------------------------------------------------------------*
FORM cu_edit_toolbar  USING    po_object TYPE REF TO cl_alv_event_toolbar_set
                            pv_interactive.

  DATA : lv_disabled,
         ls_button TYPE stb_button.

  CLEAR : ls_button.
  ls_button-butn_type = '3'.
  APPEND ls_button TO po_object->mt_toolbar.

  CLEAR : ls_button.
  ls_button-function = 'CUITAB'.
  ls_button-icon = icon_detail.
  ls_button-quickinfo = 'Insert CU Data'.
  ls_button-text = TEXT-t02.
  APPEND ls_button TO po_object->mt_toolbar.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form user_command
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> E_UCOMM
*&---------------------------------------------------------------------*
FORM user_command  USING    pv_ucomm.

  CASE pv_ucomm.
    WHEN 'CUITAB'.
      PERFORM insert_cu_data.
    WHEN 'TAITAB'.
      PERFORM insert_ta_data.
    WHEN 'CCITAB'.
      PERFORM insert_cc_data.
    WHEN 'NCITAB'.
      PERFORM insert_nc_data.
  ENDCASE.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form insert_data_to_tables
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM insert_cu_data .

  DATA : lt_roid      TYPE lvc_t_roid,
         ls_roid      TYPE lvc_s_roid,
         lv_answer(1),
         lv_bookingid TYPE zc103sdt0011-bookingid,
         lv_tabix     TYPE sy-tabix,
         lv_orderid   TYPE zc103sdt0006-orderid.

*-- For Mileage
  DATA : BEGIN OF ls_mile.
*           input_head TYPE zc103sdt0015-input_head,
*           input_line TYPE zc103sdt0015-input_line.
           INCLUDE STRUCTURE zc103sdt0010.
  DATA : END OF ls_mile,
  lt_mile LIKE TABLE OF ls_mile.

*-- For Booking
  DATA : BEGIN OF ls_booking.
*           input_head TYPE zc103sdt0015-input_head,
*           input_line TYPE zc103sdt0015-input_line.
           INCLUDE STRUCTURE zc103sdt0011.
  DATA : END OF ls_booking,
  lt_booking LIKE TABLE OF ls_booking.

  CALL METHOD go_101_alv_grid->get_selected_rows
    IMPORTING
      et_row_no = lt_roid.

  IF lt_roid IS INITIAL.
    MESSAGE i000 WITH TEXT-e01 DISPLAY LIKE 'E'.
    EXIT.
  ENDIF.

*-- Pop-up Dialog
  PERFORM set_popup_to_confirm CHANGING lv_answer.
  CHECK lv_answer  EQ '1'.

*-- Set field : Text to Value
  PERFORM set_cu_table_to_value.

*-- Check so_status EQ F
  LOOP AT lt_roid INTO ls_roid.
    READ TABLE gt_cudisplay INTO gs_cudisplay INDEX ls_roid-row_id.
    IF gs_cudisplay-so_status EQ 'F'.
      MESSAGE i001 WITH gs_cudisplay-input_head '건은 유효하지 않은 데이터 입니다.' DISPLAY LIKE 'E'.
      PERFORM set_head_value_to_text.
      PERFORM refresh_cu_table.
      LEAVE TO SCREEN 100.
    ELSEIF gs_cudisplay-so_status EQ 'Y'.
      MESSAGE i001 WITH gs_cudisplay-input_head '건은 오더 전환이 완료된 건입니다.' DISPLAY LIKE 'E'.
      PERFORM set_head_value_to_text.
      PERFORM refresh_cu_table.
      LEAVE TO SCREEN 100.
    ENDIF.
  ENDLOOP.

*-- Insert Data to Tables
  LOOP AT lt_roid INTO ls_roid.
    CLEAR : lt_booking, lt_mile.
**********************************************************************
*-- For '여객 예약 테이블'
    READ TABLE gt_cudisplay INTO gs_cudisplay INDEX ls_roid-row_id.
    lv_tabix = sy-tabix.
    PERFORM insert_booking_table CHANGING ls_booking lv_bookingid.
    APPEND ls_booking TO lt_booking.
**********************************************************************
*-- For '마일리지 이력 테이블'
    READ TABLE gt_cu INTO gs_cu WITH KEY input_head = gs_cudisplay-input_head.
    IF ( gs_cu-used_mileage IS INITIAL ).
*-- Insert Mileage
      PERFORM insert_mileage CHANGING ls_mile.
*-- Setting Bookingid
      ls_mile-bookingid = lv_bookingid.
      APPEND ls_mile TO lt_mile.
    ELSEIF ( gs_cu-used_mileage IS NOT INITIAL ).
*-- Use Mileage
      PERFORM count_mileage.
    ENDIF.
**********************************************************************
*-- For '항공권 테이블, 유료상품, 기내식 테이블'
    PERFORM insert_boarding_table USING lv_bookingid lv_tabix.

**********************************************************************
*-- For '판매오더 헤더, 라인'
    PERFORM insert_sales_order USING lv_bookingid lv_orderid.

    MODIFY gt_cudisplay FROM gs_cudisplay INDEX lv_tabix.

**********************************************************************
*-- For '대금청구 헤더, 라인'
    PERFORM insert_billing USING lv_orderid lv_bookingid.

**********************************************************************
*-- 전체 DB Table 적용
    MODIFY zc103sdt0011 FROM TABLE lt_booking.
    MODIFY zc103sdt0010 FROM TABLE lt_mile.
    LOOP AT gt_cu INTO gs_cu WHERE so_status = 'Y'.
      UPDATE zc103sdt0015 SET so_status = gs_cu-so_status WHERE input_head = gs_cu-input_head
                                                            AND input_line = gs_cu-input_line.
    ENDLOOP.

  ENDLOOP.

  IF sy-subrc EQ 0.
    COMMIT WORK.
  ELSE.
    ROLLBACK WORK.
  ENDIF.

  PERFORM set_head_value_to_text.
  PERFORM refresh_cu_table.

  MESSAGE i000 WITH TEXT-s01 DISPLAY LIKE 'S'.

  CALL METHOD cl_gui_cfw=>set_new_ok_code
    EXPORTING
      new_code = 'ENTER'.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form ta_edit_toolbar
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> E_OBJECT
*&      --> E_INTERACTIVE
*&---------------------------------------------------------------------*
FORM ta_edit_toolbar  USING    po_object TYPE REF TO cl_alv_event_toolbar_set
                               pv_interactive.
  DATA : lv_disabled,
         ls_button TYPE stb_button.

  CLEAR : ls_button.
  ls_button-butn_type = '3'.
  APPEND ls_button TO po_object->mt_toolbar.

  CLEAR : ls_button.
  ls_button-function = 'TAITAB'.
  ls_button-icon = icon_detail.
  ls_button-quickinfo = 'Insert TA Data'.
  ls_button-text = TEXT-t02.
  APPEND ls_button TO po_object->mt_toolbar.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form cc_edit_toolbar
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> E_OBJECT
*&      --> E_INTERACTIVE
*&---------------------------------------------------------------------*
FORM cc_edit_toolbar  USING    po_object TYPE REF TO cl_alv_event_toolbar_set
                               pv_interactive.

  DATA : lv_disabled,
         ls_button TYPE stb_button.

  CLEAR : ls_button.
  ls_button-butn_type = '3'.
  APPEND ls_button TO po_object->mt_toolbar.

  CLEAR : ls_button.
  ls_button-function = 'CCITAB'.
  ls_button-icon = icon_detail.
  ls_button-quickinfo = 'Insert CC Data'.
  ls_button-text = TEXT-t02.
  APPEND ls_button TO po_object->mt_toolbar.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form nc_edit_toolbar
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> E_OBJECT
*&      --> E_INTERACTIVE
*&---------------------------------------------------------------------*
FORM nc_edit_toolbar  USING    po_object TYPE REF TO cl_alv_event_toolbar_set
                               pv_interactive.

  DATA : lv_disabled,
           ls_button TYPE stb_button.

  CLEAR : ls_button.
  ls_button-butn_type = '3'.
  APPEND ls_button TO po_object->mt_toolbar.

  CLEAR : ls_button.
  ls_button-function = 'NCITAB'.
  ls_button-icon = icon_detail.
  ls_button-quickinfo = 'Insert NC Data'.
  ls_button-text = TEXT-t02.
  APPEND ls_button TO po_object->mt_toolbar.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_popup_to_confirm
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      <-- LV_ANSWER
*&---------------------------------------------------------------------*
FORM set_popup_to_confirm  CHANGING pv_answer.

  CALL FUNCTION 'ZC1F030001'
    EXPORTING
      iv_action = '판매오더로 전환'
    IMPORTING
      ev_answer = pv_answer.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_cu_table_to_value
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_cu_table_to_value .

*-- Convert Text to Value
  LOOP AT gt_cudisplay ASSIGNING FIELD-SYMBOL(<fs_cu>).
*-- Input_type
    CASE <fs_cu>-input_type.
      WHEN '일반 고객(B2C)'.
        <fs_cu>-input_type = 'CU'.
      WHEN '계약 화물사(B2B)'.
        <fs_cu>-input_type = 'CC'.
      WHEN '미계약 화물사(B2B)'.
        <fs_cu>-input_type = 'NC'.
      WHEN '여행사(B2B)'.
        <fs_cu>-input_type = 'TA'.
    ENDCASE.

*-- Countryfrom
    CASE <fs_cu>-countryfrom.
      WHEN '대한민국(인천)'.
        <fs_cu>-countryfrom = '00'.
      WHEN '대한민국(부산/김해)'.
        <fs_cu>-countryfrom = '01'.
      WHEN '오스트레일리아(시드니)'.
        <fs_cu>-countryfrom = '02'.
      WHEN '베트남(하노이)'.
        <fs_cu>-countryfrom = '03'.
      WHEN '아랍에미리트(두바이)'.
        <fs_cu>-countryfrom = '04'.
      WHEN '독일(프랑크푸르트)'.
        <fs_cu>-countryfrom = '05'.
      WHEN '미국(LA)'.
        <fs_cu>-countryfrom = '06'.
    ENDCASE.

*-- Countryto
    CASE <fs_cu>-countryto.
      WHEN '대한민국(인천)'.
        <fs_cu>-countryto = '00'.
      WHEN '대한민국(부산/김해)'.
        <fs_cu>-countryto = '01'.
      WHEN '오스트레일리아(시드니)'.
        <fs_cu>-countryto = '02'.
      WHEN '베트남(하노이)'.
        <fs_cu>-countryto = '03'.
      WHEN '아랍에미리트(두바이)'.
        <fs_cu>-countryto = '04'.
      WHEN '독일(프랑크푸르트)'.
        <fs_cu>-countryto = '05'.
      WHEN '미국(LA)'.
        <fs_cu>-countryto = '06'.
    ENDCASE.

*-- so_status
    CASE <fs_cu>-so_status.
      WHEN '판매오더 전환 완료'.
        <fs_cu>-so_status = 'Y'.
      WHEN '판매오더 전환 미완료'.
        <fs_cu>-so_status = 'N'.
      WHEN '유효성 검사 실패'.
        <fs_cu>-so_status = 'F'.
    ENDCASE.

  ENDLOOP.

  UNASSIGN : <fs_cu>.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form insert_mileage
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM insert_mileage CHANGING ps_mile TYPE zc103sdt0010.

  DATA : lv_number TYPE n LENGTH 4.

*-- Mileage Number range
  CALL FUNCTION 'NUMBER_GET_NEXT'
    EXPORTING
      nr_range_nr = '01'
      object      = 'ZMILENUM'
    IMPORTING
      number      = lv_number
    EXCEPTIONS
      OTHERS      = 1.

  IF sy-subrc EQ 0.
    CONCATENATE 'MILE' lv_number INTO ps_mile-mileage_id.
  ELSE.
    MESSAGE e000 WITH TEXT-e02.
    EXIT.
  ENDIF.

*-- Calculate Expire date
  CALL FUNCTION 'RP_CALC_DATE_IN_INTERVAL'
    EXPORTING
      date      = gs_cu-input_date    " 기준 날짜
      days      = 0
      months    = 0
      years     = 3
    IMPORTING
      calc_date = ps_mile-expire_date.     " 결과 날짜

*-- Insert Mileage Data
  ps_mile-custid = gs_cu-custid.
  ps_mile-occur_date = gs_cu-input_date.
  ps_mile-event_type = 'A'.
  ps_mile-mile_amount = 0.

*-- Cacluate Mileage
  IF ( gs_cu-class = 'P' ).
    ps_mile-mile_total = gs_cu-unit_price / 10.
  ELSEIF ( gs_cu-class EQ 'E' ).
    ps_mile-mile_total = gs_cu-unit_price / 20.
  ENDIF.

  ps_mile-balance_after = ps_mile-mile_total.
  ps_mile-currency = gs_cu-currency.
  ps_mile-erdat = sy-datum.
  ps_mile-ernam = sy-uname.
  ps_mile-erzet = sy-uzeit.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form insert_booking_table
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      <-- LS_BOOKING
*&---------------------------------------------------------------------*
FORM insert_booking_table  CHANGING ps_booking TYPE zc103sdt0011 pv_bookingid.

  DATA : lv_number TYPE n LENGTH 5.

*-- Bookingid Number range
  CALL FUNCTION 'NUMBER_GET_NEXT'
    EXPORTING
      nr_range_nr = '01'
      object      = 'ZBOOKINGID'
    IMPORTING
      number      = lv_number
    EXCEPTIONS
      OTHERS      = 1.

  IF sy-subrc EQ 0.
    CONCATENATE 'BKG' lv_number INTO ps_booking-bookingid.
  ELSE.
    MESSAGE e000 WITH TEXT-e03.
    EXIT.
  ENDIF.

  ps_booking-custid = gs_cudisplay-custid.
  ps_booking-conditionid = gs_cudisplay-conditionid.
  ps_booking-countryfrom = gs_cudisplay-countryfrom.
  ps_booking-countryto = gs_cudisplay-countryto.
  ps_booking-flightid = gs_cudisplay-flightid.
  ps_booking-scheduleid = gs_cudisplay-scheduleid.
  ps_booking-bookingdate = gs_cudisplay-input_date.
  ps_booking-totalticket = gs_cudisplay-ticket_quantity.
  ps_booking-totalprice = gs_cudisplay-total_price.
  ps_booking-currency = gs_cudisplay-currency.
  ps_booking-book_status = 'A'.
  ps_booking-erdat = sy-datum.
  ps_booking-ernam = sy-uname.
  ps_booking-erzet = sy-uzeit.

  pv_bookingid = ps_booking-bookingid.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form count_mileage
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      <-- LS_MILE
*&---------------------------------------------------------------------*
FORM count_mileage.

  DATA : lt_mile_data TYPE TABLE OF zc103sdt0010,
         lv_used_mile TYPE zc103sdt0010-mile_amount.

*-- Get Mileage table by custid
  SELECT mileage_id, custid, occur_date, expire_date, event_type, bookingid,
         mile_amount, balance_after, mile_total, currency, erdat, ernam, erzet,
         aenam, aezet, aedat
    FROM zc103sdt0010
    WHERE custid EQ @gs_cu-custid
    INTO CORRESPONDING FIELDS OF TABLE @lt_mile_data.

  lv_used_mile = gs_cu-used_mileage.

*-- Count Mileage
  SORT : lt_mile_data BY expire_date ASCENDING.
  LOOP AT lt_mile_data ASSIGNING FIELD-SYMBOL(<fs_mile>).
    IF ( lv_used_mile >= 0 ).
      IF ( <fs_mile>-event_type = 'B' ) OR
       ( <fs_mile>-event_type = 'A' ).
        IF ( <fs_mile>-balance_after > lv_used_mile ).
          <fs_mile>-balance_after -= lv_used_mile.
          <fs_mile>-mile_amount +=  lv_used_mile.
          <fs_mile>-event_type = 'B'.
          lv_used_mile = 0.
        ELSEIF ( <fs_mile>-balance_after = lv_used_mile ).
          <fs_mile>-balance_after = 0.
          <fs_mile>-mile_amount = <fs_mile>-mile_total.
          <fs_mile>-event_type = 'C'.
          lv_used_mile = 0.
        ELSE.
          lv_used_mile -= <fs_mile>-balance_after.
          <fs_mile>-balance_after = 0.
          <fs_mile>-mile_amount = <fs_mile>-mile_total.
          <fs_mile>-event_type = 'C'.
        ENDIF.
      ENDIF.
*-- Time Stamp
      IF <fs_mile>-erdat IS INITIAL.
        <fs_mile>-erdat = sy-datum.
        <fs_mile>-ernam = sy-uname.
        <fs_mile>-erzet = sy-uzeit.
      ELSE.
        <fs_mile>-aedat = sy-datum.
        <fs_mile>-aenam = sy-uname.
        <fs_mile>-aezet = sy-uzeit.
      ENDIF.
    ELSE.
      EXIT.
    ENDIF.
  ENDLOOP.

  MODIFY zc103sdt0010 FROM TABLE lt_mile_data.

  IF sy-subrc EQ 0.
    COMMIT WORK.
  ELSE.
    ROLLBACK WORK.
  ENDIF.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form insert_boarding_table
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM insert_boarding_table USING pv_bookingid pv_tabix.

*-- For boarding
  DATA : lt_boarding  TYPE TABLE OF zc103sdt0014,
         ls_boarding  TYPE zc103sdt0014,
         lv_number    TYPE n LENGTH 5,
         lv_name      TYPE zc103sdt0002-name,
         lv_email     TYPE zc103sdt0002-email,
         lv_status(1),
         lv_tabix     TYPE sy-tabix.

*-- For Souvenir
  DATA : lt_souvenir       TYPE TABLE OF zc103sdt0012,
         ls_souvenir       TYPE zc103sdt0012,
         lv_souvenir_count TYPE i,
         lv_souvenir_text  TYPE zc103mmt0001-matname,
         lv_souvenir_code  TYPE zc103sdt0012-souvenir_type,
         lv_souvenir_price TYPE zc103mmt0005-price.

*-- For meal
  DATA : lt_meal TYPE TABLE OF zc103sdt0013,
         ls_meal TYPE zc103sdt0013.

  CLEAR : gs_cu.

*-- Insert boarding table
  LOOP AT gt_cu INTO gs_cu WHERE input_head = gs_cudisplay-input_head.
    lv_tabix = sy-tabix.
    CLEAR : ls_souvenir, ls_boarding, ls_meal.
**********************************************************************
*  For Boarding
**********************************************************************
*-- Ticketid Number range
    CLEAR : lv_number.
    CALL FUNCTION 'NUMBER_GET_NEXT'
      EXPORTING
        nr_range_nr = '01'
        object      = 'ZTICKETID'
      IMPORTING
        number      = lv_number
      EXCEPTIONS
        OTHERS      = 1.

    IF sy-subrc EQ 0.
      CONCATENATE 'TKT' lv_number INTO ls_boarding-ticketid.
    ELSE.
      MESSAGE e000 WITH TEXT-e04.
      EXIT.
    ENDIF.

    ls_boarding-bookingid = pv_bookingid.
    ls_boarding-class = gs_cu-class.

*-- PassengerID Number range
    CLEAR : lv_number.
    CALL FUNCTION 'NUMBER_GET_NEXT'
      EXPORTING
        nr_range_nr = '01'
        object      = 'ZPASSENGER'
      IMPORTING
        number      = lv_number
      EXCEPTIONS
        OTHERS      = 1.

    IF sy-subrc EQ 0.
      CONCATENATE 'PSG' lv_number INTO ls_boarding-passengerid.
    ELSE.
      MESSAGE e000 WITH TEXT-e04.
      CONTINUE.
    ENDIF.
*-- Get name
    SELECT SINGLE name, email
      FROM zc103sdt0002
      WHERE custid EQ @gs_cu-custid
      INTO ( @lv_name, @lv_email ).

    ls_boarding-passengername = lv_name.
    ls_boarding-passengermail = lv_email.

*-- Seat code
    CALL FUNCTION 'ZC1FM03SD0002'
      EXPORTING
        iv_scheduleid = gs_cu-scheduleid
        iv_class      = gs_cu-class
      IMPORTING
        ev_seatcode   = ls_boarding-seatcode
        ev_result     = lv_status.

*-- Change Seat Table Status
    UPDATE zc103sdt0021 SET assigned = 'Y'
                            ticketid = ls_boarding-ticketid
                            aedat = sy-datum
                            aezet = sy-uzeit
                            aenam = sy-uname
    WHERE scheduleid = gs_cu-scheduleid
                                             AND seatcode = ls_boarding-seatcode.

    IF lv_status EQ 'F'.
*-- 유효성 검사 실패
      CLEAR : ls_boarding.
      gs_cu-so_status = 'F'.
      MODIFY gt_cu FROM gs_cu INDEX lv_tabix.
      gs_cudisplay-so_status = 'F'.
      MESSAGE i000 WITH TEXT-e06 DISPLAY LIKE 'E'.
      MODIFY gt_cudisplay FROM gs_cudisplay INDEX pv_tabix.
*-- Chage DB Status
      UPDATE zc103sdt0015 SET so_status = gs_cudisplay-so_status WHERE input_head = gs_cu-input_head
                                                                   AND input_line = gs_cu-input_line.

      PERFORM refresh_cu_table.
      PERFORM set_head_value_to_text.
      CALL METHOD cl_gui_cfw=>set_new_ok_code
        EXPORTING
          new_code = 'ENTER'.
      LEAVE TO SCREEN 100.
    ENDIF.

    ls_boarding-countryfrom = gs_cu-countryfrom.
    ls_boarding-countryto = gs_cu-countryto.
    ls_boarding-flightid = gs_cu-flightid.
    ls_boarding-scheduleid = gs_cu-scheduleid.
    ls_boarding-mealtype = gs_cu-meal_type.
    ls_boarding-ticket_status = 'N'.
    ls_boarding-erdat = sy-datum.
    ls_boarding-ernam = sy-uname.
    ls_boarding-erzet = sy-uzeit.

    APPEND ls_boarding TO lt_boarding.

**********************************************************************
* For Souvenir
**********************************************************************
*-- Set Souvenir data
    lv_souvenir_count += 1.
    ls_souvenir-ticketid = ls_boarding-ticketid.
    ls_souvenir-souvenirid = lv_souvenir_count.
    ls_souvenir-passengerid = ls_boarding-passengerid.

*-- Get souvenir_type
    SELECT SINGLE matname
      FROM zc103mmt0001
      WHERE matid EQ @gs_cu-matid
      INTO ( @lv_souvenir_text ).

    CASE lv_souvenir_text.
      WHEN '향수 세트'.
        lv_souvenir_code = 'A'.
      WHEN '화장품'.
        lv_souvenir_code = 'B'.
      WHEN '미니어처'.
        lv_souvenir_code = 'C'.
      WHEN '초콜릿 & 와인 세트'.
        lv_souvenir_code = 'D'.
      WHEN '프레스티지 어매니티 키트'.
        lv_souvenir_code = 'E'.
      WHEN '이코노미 칫솔/치약 키트'.
        lv_souvenir_code = 'F'.
      WHEN '기내 전용 안대 & 귀마개 세트'.
        lv_souvenir_code = 'G'.
      WHEN '기내용 핸드크림 & 림밤 세트'.
        lv_souvenir_code = 'H'.
    ENDCASE.

    ls_souvenir-souvenir_type = lv_souvenir_code.
    ls_souvenir-qty = gs_cu-souvenir_qty.
    ls_souvenir-unit = gs_cu-souvenir_unit.

*-- Get souvenir unit price
    SELECT SINGLE price
      FROM zc103mmt0005
      WHERE matid EQ @gs_cu-matid
      INTO ( @lv_souvenir_price ).

    ls_souvenir-unit_price = lv_souvenir_price.
    ls_souvenir-total_price = ( lv_souvenir_price * ls_souvenir-qty ).
    ls_souvenir-currency = gs_cu-currency.
    ls_souvenir-status = 'N'.
    ls_souvenir-erdat = sy-datum.
    ls_souvenir-ernam = sy-uname.
    ls_souvenir-erzet = sy-uzeit.

    APPEND ls_souvenir TO lt_souvenir.

**********************************************************************
*  For Meal
**********************************************************************
    ls_meal-ticketid = ls_boarding-ticketid.
    ls_meal-passengerid = ls_boarding-passengerid.
    ls_meal-mealtype = gs_cu-meal_type.
    ls_meal-erdat = sy-datum.
    ls_meal-ernam = sy-uname.
    ls_meal-erzet = sy-uzeit.

    APPEND ls_meal TO lt_meal.

    IF sy-subrc EQ 0.
      gs_cu-so_status = 'Y'.
      MODIFY gt_cu FROM gs_cu INDEX lv_tabix.
    ENDIF.

  ENDLOOP.

*-- Insert DB table
  IF ( lt_boarding IS NOT INITIAL ).
    MODIFY zc103sdt0014 FROM TABLE lt_boarding.
  ENDIF.

  IF ( lt_souvenir IS NOT INITIAL ).
    MODIFY zc103sdt0012 FROM TABLE lt_souvenir.
  ENDIF.

  IF ( lt_meal IS NOT INITIAL ).
    MODIFY zc103sdt0013 FROM TABLE lt_meal.
  ENDIF.

  IF sy-subrc EQ 0.
    COMMIT WORK.
  ELSE.
    ROLLBACK WORK.
  ENDIF.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form insert_sales_order
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM insert_sales_order USING pv_bookingid pv_orderid.

  DATA : lv_number     TYPE n LENGTH 6,
         lv_itemno     TYPE i,
         lv_departdate TYPE zc103sdt0018-departdate.

  DATA : lt_hso TYPE TABLE OF zc103sdt0006,
         ls_hso TYPE zc103sdt0006,
         lt_lso TYPE TABLE OF zc103sdt0007,
         ls_lso TYPE zc103sdt0007.

  DATA : lv_discount      TYPE i,
         lv_discount_rate TYPE p DECIMALS 1.

*-- Insert SO Header
*-- Orderid Number range
  CLEAR : lv_number.
  CALL FUNCTION 'NUMBER_GET_NEXT'
    EXPORTING
      nr_range_nr = '01'
      object      = 'ZORDERID'
    IMPORTING
      number      = lv_number
    EXCEPTIONS
      OTHERS      = 1.

  IF sy-subrc EQ 0.
    CONCATENATE 'SO' lv_number INTO ls_hso-orderid.
  ELSE.
    MESSAGE e000 WITH TEXT-e05.
    EXIT.
  ENDIF.

  pv_orderid = ls_hso-orderid.

  ls_hso-custid = gs_cudisplay-custid.
  ls_hso-conditionid = gs_cudisplay-conditionid.
  ls_hso-order_date = gs_cudisplay-input_date.

*-- Get Cancel Deadline
  SELECT SINGLE departdate
    FROM zc103sdt0018
    WHERE scheduleid EQ @gs_cudisplay-scheduleid
    INTO ( @lv_departdate ).

*-- Calculate Cancel Deadline
  lv_departdate -= 14.
  ls_hso-cancel_deadline = lv_departdate.
  ls_hso-order_type = 'C'.
  ls_hso-total_amount = gs_cudisplay-total_price.
  ls_hso-currency = gs_cudisplay-currency.
  ls_hso-order_status = 'Y'.
  ls_hso-billing_status = 'X'.
  ls_hso-srv_end_status = 'X'.
  ls_hso-erdat = sy-datum.
  ls_hso-ernam = sy-uname.
  ls_hso-erzet = sy-uzeit.

  APPEND ls_hso TO lt_hso.

*-- Insert SO head data
  MODIFY zc103sdt0006 FROM TABLE lt_hso.

  IF sy-subrc EQ 0.
    gs_cudisplay-orderid = ls_hso-orderid.
  ENDIF.

*-- Set SO line
  LOOP AT gt_cu INTO gs_cu WHERE input_head = gs_cudisplay-input_head.
    lv_itemno += 1.
    ls_lso-orderid = ls_hso-orderid.
    ls_lso-orderitemno = lv_itemno.
    ls_lso-bookingid = pv_bookingid.
    ls_lso-charged_item = 'A'.
    ls_lso-ticket_quantity = gs_cu-ticket_quantity.
    ls_lso-ticket_unit = gs_cu-ticket_unit.
    ls_lso-unit_price = gs_cu-unit_price.
    ls_lso-tax_amount = ( gs_cu-total_price / 10 ).
*-- Get discount percent
    SELECT SINGLE discountrate
      FROM zc103sdt0003
      WHERE conditionid EQ @gs_cu-conditionid
      INTO ( @lv_discount ).

    lv_discount_rate = lv_discount / 100.

    ls_lso-discount = ( gs_cu-unit_price * lv_discount_rate ) * gs_cu-ticket_quantity.
    ls_lso-currency = gs_cu-currency.
    ls_lso-used_mileage = gs_cu-used_mileage.
    ls_lso-order_status = 'Y'.
    ls_lso-srv_end_status = 'X'.
    ls_lso-erdat = sy-datum.
    ls_lso-erzet = sy-uzeit.
    ls_lso-ernam = sy-uname.

    APPEND ls_lso TO lt_lso.

  ENDLOOP.

*-- Insert SO line data
  MODIFY zc103sdt0007 FROM TABLE lt_lso.

  IF sy-subrc EQ 0.
    gs_cudisplay-so_status = 'Y'.
    COMMIT WORK.
  ELSE.
    ROLLBACK WORK.
  ENDIF.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form cu_double_click
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> E_ROW
*&      --> E_COLUMN
*&---------------------------------------------------------------------*
FORM cu_double_click  USING    pv_row
                               pv_column.

  DATA : lv_tabix TYPE sy-tabix.

  CLEAR : gt_hdisplay, gt_ldisplay, gs_hdisplay, gs_ldisplay,
          gt_hso, gs_hso, gt_lso, gs_lso.

  READ TABLE gt_cudisplay INTO gs_cudisplay INDEX pv_row.

*-- Get head data
  SELECT orderid, bpid, custid, conditionid, order_date, cancel_deadline,
         order_type, total_amount, currency, cancel_reason, order_status,
         billing_status, srv_end_status
    FROM zc103sdt0006
    WHERE orderid EQ @gs_cudisplay-orderid
    INTO CORRESPONDING FIELDS OF TABLE @gt_hso.

  IF gt_hso IS INITIAL.
    MESSAGE i000 WITH TEXT-e07 DISPLAY LIKE 'E'.
    EXIT.
  ENDIF.

*-- Get line data
  SELECT orderid, orderitemno, bookingid, transportid, charged_item, description,
         ticket_quantity, ticket_unit, cargo_weight, cargo_unit, unit_price,
         tax_amount, discount, currency, used_mileage, order_status, srv_end_status
    FROM zc103sdt0007
    WHERE orderid EQ @gs_cudisplay-orderid
    INTO CORRESPONDING FIELDS OF TABLE @gt_lso.

*-- Move data to Head display
  LOOP AT gt_hso INTO gs_hso.
    gs_hdisplay = CORRESPONDING #( gs_hso ).
    APPEND gs_hdisplay TO gt_hdisplay.
  ENDLOOP.

*-- Move data to Line display
  LOOP AT gt_lso INTO gs_lso.
    gs_ldisplay = CORRESPONDING #( gs_lso ).
    APPEND gs_ldisplay TO gt_ldisplay.
  ENDLOOP.

  PERFORM set_so_head_to_text.
  PERFORM set_so_line_to_text.

  PERFORM refresh_brtop_table.
  PERFORM refresh_brbottom_table.

  CALL METHOD cl_gui_cfw=>set_new_ok_code
    EXPORTING
      new_code = 'ENTER'.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_so_head_to_text
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_so_head_to_text .

*-- Set Head Text field
  LOOP AT gt_hdisplay ASSIGNING FIELD-SYMBOL(<fs_hdis>).
*-- For Order Type
    CASE <fs_hdis>-order_type.
      WHEN 'T'.
        <fs_hdis>-order_type = '여행사'.
      WHEN 'B'.
        <fs_hdis>-order_type = '계약 화물사'.
      WHEN 'NB'.
        <fs_hdis>-order_type = '미계약 화물사'.
      WHEN 'C'.
        <fs_hdis>-order_type = '일반 고객'.
    ENDCASE.
*-- For Order Status
    CASE <fs_hdis>-order_status.
      WHEN 'Y'.
        <fs_hdis>-order_status = '결제 완료'.
      WHEN 'N'.
        <fs_hdis>-order_status = '미결제'.
      WHEN 'C'.
        <fs_hdis>-order_status = '결제 취소'.
    ENDCASE.
*-- For Billing Status
    CASE <fs_hdis>-billing_status.
      WHEN 'Y'.
        <fs_hdis>-billing_status = '대금청구 완료'.
      WHEN 'N'.
        <fs_hdis>-billing_status = '대금청구 미완료'.
      WHEN 'X'.
        <fs_hdis>-billing_status = '일반 고객(B2C, 청구 불필요)'.
    ENDCASE.
*-- For Service end status
    CASE <fs_hdis>-srv_end_status.
      WHEN 'Y'.
        <fs_hdis>-srv_end_status = '서비스 종료'.
      WHEN 'N'.
        <fs_hdis>-srv_end_status = '서비스 미종료'.
      WHEN 'X'.
        <fs_hdis>-srv_end_status = '일반고객(B2C, 청구 불필요)'.
    ENDCASE.
  ENDLOOP.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_so_line_to_text
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_so_line_to_text .

*-- SET Line Text FIELD
  LOOP AT gt_ldisplay ASSIGNING FIELD-SYMBOL(<fs_ldis>).
*-- For Charged Item
    CASE <fs_ldis>-charged_item.
      WHEN 'A'.
        <fs_ldis>-charged_item = '여객'.
      WHEN 'B'.
        <fs_ldis>-charged_item = '화물'.
    ENDCASE.
*-- For Order Status
    CASE <fs_ldis>-order_status.
      WHEN 'Y'.
        <fs_ldis>-order_status = '결제 완료'.
      WHEN 'N'.
        <fs_ldis>-order_status = '미결제'.
      WHEN 'C'.
        <fs_ldis>-order_status = '결제 취소'.
    ENDCASE.
*-- For Service end status
    CASE <fs_ldis>-srv_end_status.
      WHEN 'Y'.
        <fs_ldis>-srv_end_status = '서비스 종료'.
      WHEN 'N'.
        <fs_ldis>-srv_end_status = '서비스 미종료'.
      WHEN 'X'.
        <fs_ldis>-srv_end_status = '일반고객(B2C, 청구 불필요)'.
    ENDCASE.
  ENDLOOP.
ENDFORM.
*&---------------------------------------------------------------------*
*& Form insert_ta_data
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM insert_ta_data .

  DATA : lt_roid      TYPE lvc_t_roid,
         ls_roid      TYPE lvc_s_roid,
         lv_answer(1),
         lv_bookingid TYPE zc103sdt0011-bookingid,
         lv_tabix     TYPE sy-tabix.

*-- For Booking
  DATA : ls_booking TYPE zc103sdt0011,
         lt_booking LIKE TABLE OF ls_booking.

*-- For check credit restirct using SO total_amount
  DATA : lv_so_total TYPE wrbtr.

  CALL METHOD go_102_alv_grid->get_selected_rows
    IMPORTING
      et_row_no = lt_roid.

  IF lt_roid IS INITIAL.
    MESSAGE i000 WITH TEXT-e01 DISPLAY LIKE 'E'.
    EXIT.
  ENDIF.

*-- Pop-up Dialog
  PERFORM set_popup_to_confirm CHANGING lv_answer.
  CHECK lv_answer EQ '1'.

*-- Set field : Text to Value
  PERFORM set_ta_table_to_value.

*-- Check so_status EQ F
  DATA : lv_tatabix TYPE sy-tabix.
  LOOP AT lt_roid INTO ls_roid.
    READ TABLE gt_tadisplay INTO gs_tadisplay INDEX ls_roid-row_id.
    lv_tatabix = sy-tabix.
    IF gs_tadisplay-so_status EQ 'F'.
      MESSAGE i001 WITH gs_tadisplay-input_head '건은 유효하지 않은 데이터 입니다.' DISPLAY LIKE 'E'.
      PERFORM set_head_value_to_text.
      PERFORM refresh_ta_table.
*-- Set Screen Number
      gv_subscreen = '0102'.
      LEAVE TO SCREEN 100.
    ELSEIF gs_tadisplay-so_status EQ 'Y'.
      MESSAGE i001 WITH gs_tadisplay-input_head '건은 오더 전환이 완료된 건입니다' DISPLAY LIKE 'E'.
      PERFORM set_head_value_to_text.
      PERFORM refresh_ta_table.
*-- Set Screen Number
      gv_subscreen = '0102'.
      LEAVE TO SCREEN 100.
    ENDIF.

*-- Get so data by bpid
    LOOP AT gt_so INTO gs_so WHERE bpid EQ gs_tadisplay-bpid.
      lv_so_total += gs_so-total_amount.
    ENDLOOP.

*-- CHECK Credit Available
    DATA : lv_input_head TYPE zc103sdt0015-input_head.

    READ TABLE gt_credit INTO gs_credit WITH KEY bpid = gs_tadisplay-bpid.
    DATA(lv_rest_credit) = gs_credit-limit_amt_year - ( gs_credit-used_amt_year + lv_so_total ).
    IF ( lv_rest_credit < gs_tadisplay-total_price ).
      MESSAGE i001 WITH gs_tadisplay-input_head '건은 여신 한도 초과로 인해 오더 전환이 불가능합니다.' DISPLAY LIKE 'E'.
      gs_tadisplay-so_status = 'F'.
      lv_input_head = gs_tadisplay-input_head.
      MODIFY gt_tadisplay FROM gs_tadisplay INDEX lv_tatabix TRANSPORTING so_status.
      UPDATE zc103sdt0015 SET so_status = 'F' WHERE input_head = lv_input_head.
      PERFORM set_head_value_to_text.
      PERFORM refresh_ta_table.
*-- Set Screen Number
      gv_subscreen = '0102'.
      LEAVE TO SCREEN 100.
    ENDIF.
  ENDLOOP.

*-- Insert Data to Tables
  LOOP AT lt_roid INTO ls_roid.
    CLEAR : lt_booking.
    READ TABLE gt_tadisplay INTO gs_tadisplay INDEX ls_roid-row_id.
    lv_tabix = sy-tabix.
**********************************************************************
*-- For '여객 예약 테이블'
    PERFORM insert_ta_booking_table CHANGING ls_booking lv_bookingid.
    APPEND ls_booking TO lt_booking.
**********************************************************************
*-- For '항공권 테이블, 유료상품, 기내식 테이블'
    PERFORM insert_ta_boarding_table USING lv_bookingid lv_tabix.

**********************************************************************
*-- For '판매오더 헤더, 라인'
    PERFORM insert_ta_sales_order USING lv_bookingid.

    MODIFY gt_tadisplay FROM gs_tadisplay INDEX lv_tabix.

**********************************************************************
*-- 전체 db Table 적용
    MODIFY zc103sdt0011 FROM TABLE lt_booking.
    LOOP AT gt_ta INTO gs_ta WHERE so_status = 'Y'.
      UPDATE zc103sdt0015 SET so_status = gs_ta-so_status WHERE input_head = gs_ta-input_head
                                                            AND input_line = gs_ta-input_line.
    ENDLOOP.

  ENDLOOP.

  IF sy-subrc EQ 0.
    COMMIT WORK.
  ELSE.
    ROLLBACK WORK.
  ENDIF.

  PERFORM set_head_value_to_text.
  PERFORM refresh_ta_table.

  MESSAGE i000 WITH TEXT-s01 DISPLAY LIKE 'S'.

  CALL METHOD cl_gui_cfw=>set_new_ok_code
    EXPORTING
      new_code = 'ENTER'.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_ta_table_to_value
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_ta_table_to_value .

*-- Convert Text to Value
  LOOP AT gt_tadisplay ASSIGNING FIELD-SYMBOL(<fs_ta>).
*-- Input_type
    CASE <fs_ta>-input_type.
      WHEN '일반 고객(B2C)'.
        <fs_ta>-input_type = 'CU'.
      WHEN '계약 화물사(B2B)'.
        <fs_ta>-input_type = 'CC'.
      WHEN '미계약 화물사(B2B)'.
        <fs_ta>-input_type = 'NC'.
      WHEN '여행사(B2B)'.
        <fs_ta>-input_type = 'TA'.
    ENDCASE.

*-- Countryfrom
    CASE <fs_ta>-countryfrom.
      WHEN '대한민국(인천)'.
        <fs_ta>-countryfrom = '00'.
      WHEN '대한민국(부산/김해)'.
        <fs_ta>-countryfrom = '01'.
      WHEN '오스트레일리아(시드니)'.
        <fs_ta>-countryfrom = '02'.
      WHEN '베트남(하노이)'.
        <fs_ta>-countryfrom = '03'.
      WHEN '아랍에미리트(두바이)'.
        <fs_ta>-countryfrom = '04'.
      WHEN '독일(프랑크푸르트)'.
        <fs_ta>-countryfrom = '05'.
      WHEN '미국(LA)'.
        <fs_ta>-countryfrom = '06'.
    ENDCASE.

*-- Countryto
    CASE <fs_ta>-countryto.
      WHEN '대한민국(인천)'.
        <fs_ta>-countryto = '00'.
      WHEN '대한민국(부산/김해)'.
        <fs_ta>-countryto = '01'.
      WHEN '오스트레일리아(시드니)'.
        <fs_ta>-countryto = '02'.
      WHEN '베트남(하노이)'.
        <fs_ta>-countryto = '03'.
      WHEN '아랍에미리트(두바이)'.
        <fs_ta>-countryto = '04'.
      WHEN '독일(프랑크푸르트)'.
        <fs_ta>-countryto = '05'.
      WHEN '미국(LA)'.
        <fs_ta>-countryto = '06'.
    ENDCASE.

*-- so_status
    CASE <fs_ta>-so_status.
      WHEN '판매오더 전환 완료'.
        <fs_ta>-so_status = 'Y'.
      WHEN '판매오더 전환 미완료'.
        <fs_ta>-so_status = 'N'.
      WHEN '유효성 검사 실패'.
        <fs_ta>-so_status = 'F'.
    ENDCASE.

  ENDLOOP.

  UNASSIGN : <fs_ta>.
ENDFORM.
*&---------------------------------------------------------------------*
*& Form insert_ta_booking_table
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      <-- LS_BOOKING
*&      <-- LV_BOOKINGID
*&---------------------------------------------------------------------*
FORM insert_ta_booking_table  CHANGING ps_booking TYPE zc103sdt0011
                                       pv_bookingid.

  DATA : lv_number TYPE n LENGTH 5.

*-- Booking Number range
  CALL FUNCTION 'NUMBER_GET_NEXT'
    EXPORTING
      nr_range_nr = '01'
      object      = 'ZBOOKINGID'
    IMPORTING
      number      = lv_number
    EXCEPTIONS
      OTHERS      = 1.

  IF sy-subrc EQ 0.
    CONCATENATE 'BKG' lv_number INTO ps_booking-bookingid.
  ELSE.
    MESSAGE e000 WITH TEXT-e03.
    EXIT.
  ENDIF.

  ps_booking-bpid = gs_tadisplay-bpid.
  ps_booking-conditionid = gs_tadisplay-conditionid.
  ps_booking-countryfrom = gs_tadisplay-countryfrom.
  ps_booking-countryto = gs_tadisplay-countryto.
  ps_booking-flightid = gs_tadisplay-flightid.
  ps_booking-scheduleid = gs_tadisplay-scheduleid.
  ps_booking-bookingdate = gs_tadisplay-input_date.
  ps_booking-totalticket = gs_tadisplay-ticket_quantity.
  ps_booking-totalprice = gs_tadisplay-total_price.
  ps_booking-currency = gs_tadisplay-currency.
  ps_booking-book_status = 'A'.
  ps_booking-erdat = sy-datum.
  ps_booking-ernam = sy-uname.
  ps_booking-erzet = sy-uzeit.

  pv_bookingid = ps_booking-bookingid.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form insert_ta_boarding_table
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> LV_BOOKINGID
*&      --> LV_TABIX
*&---------------------------------------------------------------------*
FORM insert_ta_boarding_table  USING    pv_bookingid
                                        pv_tabix.

*-- For Boarding
  DATA : lt_boarding  TYPE TABLE OF zc103sdt0014,
         ls_boarding  TYPE zc103sdt0014,
         lv_number    TYPE n LENGTH 5,
         lv_name      TYPE zc103sdt0002-name,
         lv_email     TYPE zc103sdt0002-email,
         lv_status(1),
         lv_tabix     TYPE sy-tabix.

*-- For Souvenir
  DATA : lt_souvenir       TYPE TABLE OF zc103sdt0012,
         ls_souvenir       TYPE zc103sdt0012,
         lv_souvenir_count TYPE i,
         lv_souvenir_text  TYPE zc103mmt0001-matname,
         lv_souvenir_code  TYPE zc103sdt0012-souvenir_type,
         lv_souvenir_price TYPE zc103mmt0005-price.

*-- For Meal
  DATA : lt_meal TYPE TABLE OF zc103sdt0013,
         ls_meal TYPE zc103sdt0013.

  CLEAR : gs_ta.

*-- Insert boarding table
  LOOP AT gt_ta ASSIGNING FIELD-SYMBOL(<fs_ta>) WHERE input_head = gs_tadisplay-input_head.
    lv_tabix = sy-tabix.
    CLEAR : ls_souvenir, ls_boarding, ls_meal.
**********************************************************************
* For Boarding
**********************************************************************
*-- Ticketid Number range
    CLEAR : lv_number.
    CALL FUNCTION 'NUMBER_GET_NEXT'
      EXPORTING
        nr_range_nr = '01'
        object      = 'ZTICKETID'
      IMPORTING
        number      = lv_number
      EXCEPTIONS
        OTHERS      = 1.

    IF sy-subrc EQ 0.
      CONCATENATE 'TKT' lv_number INTO ls_boarding-ticketid.
    ELSE.
      MESSAGE e000 WITH TEXT-e04.
      EXIT.
    ENDIF.

    ls_boarding-bookingid = pv_bookingid.
    ls_boarding-class = <fs_ta>-class.

*-- PassengerID Number range
    CLEAR : lv_number.
    CALL FUNCTION 'NUMBER_GET_NEXT'
      EXPORTING
        nr_range_nr = '01'
        object      = 'ZPASSENGER'
      IMPORTING
        number      = lv_number
      EXCEPTIONS
        OTHERS      = 1.

    IF sy-subrc EQ 0.
      CONCATENATE 'PSG' lv_number INTO ls_boarding-passengerid.
    ELSE.
      MESSAGE e000 WITH TEXT-e04.
      CONTINUE.
    ENDIF.

    ls_boarding-passengername = <fs_ta>-unrg_custname.
    ls_boarding-passengermail = <fs_ta>-unrg_custemail.

*-- Seat code
    CALL FUNCTION 'ZC1FM03SD0002'
      EXPORTING
        iv_scheduleid = <fs_ta>-scheduleid
        iv_class      = <fs_ta>-class
      IMPORTING
        ev_seatcode   = ls_boarding-seatcode
        ev_result     = lv_status.

*-- Update Seat Table Status
    UPDATE zc103sdt0021 SET assigned = 'Y'
                            ticketid = ls_boarding-ticketid
                            aedat = sy-datum
                            aenam = sy-uname
                            aezet = sy-uzeit
    WHERE scheduleid = <fs_ta>-scheduleid
                                             AND seatcode = ls_boarding-seatcode.

    IF lv_status EQ 'F'.
*-- 유효성 검사 실패
      CLEAR : ls_boarding.
      <fs_ta>-so_status = 'F'.
      gs_tadisplay-so_status = 'F'.
      MESSAGE i000 WITH TEXT-e06 DISPLAY LIKE 'E'.
      MODIFY gt_tadisplay FROM gs_tadisplay INDEX pv_tabix.
*-- Change DB status
      UPDATE zc103sdt0015 SET so_status = gs_tadisplay-so_status
       WHERE input_head = <fs_ta>-input_head
         AND input_line = <fs_ta>-input_line.
      PERFORM refresh_ta_table.
      PERFORM set_head_value_to_text.
      CALL METHOD cl_gui_cfw=>set_new_ok_code
        EXPORTING
          new_code = 'ENTER'.
      gv_subscreen = '0102'.
      LEAVE TO SCREEN 100.
    ENDIF.

    ls_boarding-countryfrom = <fs_ta>-countryfrom.
    ls_boarding-countryto = <fs_ta>-countryto.
    ls_boarding-flightid = <fs_ta>-flightid.
    ls_boarding-scheduleid = <fs_ta>-scheduleid.
    ls_boarding-mealtype = <fs_ta>-meal_type.
    ls_boarding-ticket_status = 'N'.
    ls_boarding-erdat = sy-datum.
    ls_boarding-ernam = sy-uname.
    ls_boarding-erzet = sy-uzeit.

    APPEND ls_boarding TO lt_boarding.

**********************************************************************
*-- For Souvenir
**********************************************************************
*-- Set Souvenir data
    lv_souvenir_count += 1.
    ls_souvenir-ticketid = ls_boarding-ticketid.
    ls_souvenir-souvenirid = lv_souvenir_count.
    ls_souvenir-passengerid = ls_boarding-passengerid.

*-- Get Souvenir_type
    SELECT SINGLE matname
      FROM zc103mmt0001
      WHERE matid EQ @<fs_ta>-matid
      INTO ( @lv_souvenir_text ).

    CASE lv_souvenir_text.
      WHEN '향수 세트'.
        lv_souvenir_code = 'A'.
      WHEN '화장품'.
        lv_souvenir_code = 'B'.
      WHEN '미니어처'.
        lv_souvenir_code = 'C'.
      WHEN '초콜릿 & 와인 세트'.
        lv_souvenir_code = 'D'.
      WHEN '프레스티지 어매니티 키트'.
        lv_souvenir_code = 'E'.
      WHEN '이코노미 칫솔/치약 키트'.
        lv_souvenir_code = 'F'.
      WHEN '기내 전용 안대 & 귀마개 세트'.
        lv_souvenir_code = 'G'.
      WHEN '기내용 핸드크림 & 림밤 세트'.
        lv_souvenir_code = 'H'.
    ENDCASE.

    ls_souvenir-souvenir_type = lv_souvenir_code.
    ls_souvenir-qty = <fs_ta>-souvenir_qty.
    ls_souvenir-unit = <fs_ta>-souvenir_unit.

*-- Get Souvenir unit price
    SELECT SINGLE price
      FROM zc103mmt0005
      WHERE matid EQ @<fs_ta>-matid
      INTO ( @lv_souvenir_price ).

    ls_souvenir-unit_price = lv_souvenir_price.
    ls_souvenir-total_price = ( lv_souvenir_price * ls_souvenir-qty ).
    ls_souvenir-currency = <fs_ta>-currency.
    ls_souvenir-status = 'N'.
    ls_souvenir-erdat = sy-datum.
    ls_souvenir-ernam = sy-uname.
    ls_souvenir-erzet = sy-uzeit.

    APPEND ls_souvenir TO lt_souvenir.

**********************************************************************
*  For Meal
**********************************************************************
    ls_meal-ticketid = ls_boarding-ticketid.
    ls_meal-passengerid = ls_boarding-passengerid.
    ls_meal-mealtype = <fs_ta>-meal_type.
    ls_meal-erdat = sy-datum.
    ls_meal-ernam = sy-uname.
    ls_meal-erzet = sy-uzeit.

    APPEND ls_meal TO lt_meal.

    <fs_ta>-so_status = 'Y'.

  ENDLOOP.

*-- INSERT db table
  IF ( lt_boarding IS NOT INITIAL ).
    MODIFY zc103sdt0014 FROM TABLE lt_boarding.
  ENDIF.

  IF ( lt_souvenir IS NOT INITIAL ).
    MODIFY zc103sdt0012 FROM TABLE lt_souvenir.
  ENDIF.

  IF ( lt_meal IS NOT INITIAL ).
    MODIFY zc103sdt0013 FROM TABLE lt_meal.
  ENDIF.

  IF sy-subrc EQ 0.
    COMMIT WORK.
  ELSE.
    ROLLBACK WORK.
  ENDIF.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form insert_ta_sales_order
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> LV_BOOKINGID
*&---------------------------------------------------------------------*
FORM insert_ta_sales_order  USING    pv_bookingid.

  DATA : lv_number     TYPE n LENGTH 6,
         lv_itemno     TYPE i,
         lv_departdate TYPE zc103sdt0018-departdate.

  DATA : lt_hso TYPE TABLE OF zc103sdt0006,
         ls_hso TYPE zc103sdt0006,
         lt_lso TYPE TABLE OF zc103sdt0007,
         ls_lso TYPE zc103sdt0007.

  DATA : lv_discount      TYPE i,
         lv_discount_rate TYPE p DECIMALS 1.
**********************************************************************
*-- Set SO Head data
**********************************************************************
*-- Orderid Number range
  CLEAR : lv_number.
  CALL FUNCTION 'NUMBER_GET_NEXT'
    EXPORTING
      nr_range_nr = '01'
      object      = 'ZORDERID'
    IMPORTING
      number      = lv_number
    EXCEPTIONS
      OTHERS      = 1.

  IF sy-subrc EQ 0.
    CONCATENATE 'SO' lv_number INTO ls_hso-orderid.
  ELSE.
    MESSAGE e000 WITH TEXT-e05.
    EXIT.
  ENDIF.

  ls_hso-bpid = gs_tadisplay-bpid.
  ls_hso-conditionid = gs_tadisplay-conditionid.
  ls_hso-order_date = gs_tadisplay-input_date.

*-- Get Departdate
  SELECT SINGLE departdate
    FROM zc103sdt0018
    WHERE scheduleid EQ @gs_tadisplay-scheduleid
    INTO ( @lv_departdate ).

*-- Calculate Cancel Deadline
  lv_departdate -= 14.
  ls_hso-cancel_deadline = lv_departdate.
  ls_hso-order_type = 'T'.
  ls_hso-total_amount = gs_tadisplay-total_price.
  ls_hso-currency = gs_tadisplay-currency.
  ls_hso-order_status = 'N'.
  ls_hso-billing_status = 'N'.
  ls_hso-srv_end_status = 'N'.
  ls_hso-erdat = sy-datum.
  ls_hso-ernam = sy-uname.
  ls_hso-erzet = sy-uzeit.

  APPEND ls_hso TO lt_hso.

*-- Insert SO head data
  MODIFY zc103sdt0006 FROM TABLE lt_hso.

  IF sy-subrc EQ 0.
    gs_tadisplay-orderid = ls_hso-orderid.
  ENDIF.

**********************************************************************
* Set line data
**********************************************************************
  LOOP AT gt_ta INTO gs_ta WHERE input_head = gs_tadisplay-input_head.
    CLEAR : ls_lso.
    lv_itemno += 1.
    ls_lso-orderid = ls_hso-orderid.
    ls_lso-orderitemno = lv_itemno.
    ls_lso-bookingid = pv_bookingid.
    ls_lso-charged_item = 'A'.
    ls_lso-ticket_quantity = gs_ta-ticket_quantity.
    ls_lso-ticket_unit = gs_ta-ticket_unit.
    ls_lso-unit_price = gs_ta-unit_price.
    ls_lso-tax_amount = ( gs_ta-total_price / 10 ).

*-- Get discount percent
    SELECT SINGLE discountrate
      FROM zc103sdt0003
      WHERE conditionid EQ @gs_ta-conditionid
      INTO ( @lv_discount ).

    lv_discount_rate = lv_discount / 100.

    ls_lso-discount = ( gs_ta-unit_price * lv_discount_rate ) * gs_ta-ticket_quantity.
    ls_lso-currency = gs_ta-currency.
    ls_lso-used_mileage = gs_ta-used_mileage.
    ls_lso-order_status = 'N'.
    ls_lso-srv_end_status = 'N'.
    ls_lso-erdat = sy-datum.
    ls_lso-erzet = sy-uzeit.
    ls_lso-ernam = sy-uname.

    APPEND ls_lso TO lt_lso.

  ENDLOOP.

*-- Insert SO line Data
  MODIFY zc103sdt0007 FROM TABLE lt_lso.

  IF sy-subrc EQ 0.
    gs_tadisplay-so_status = 'Y'.
    COMMIT WORK.
  ELSE.
    ROLLBACK WORK.
  ENDIF.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form ta_double_click
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> E_ROW
*&      --> E_COLUMN
*&---------------------------------------------------------------------*
FORM ta_double_click  USING    pv_row
                               pv_column.

  DATA : lv_tabix TYPE sy-tabix.

  CLEAR : gt_hdisplay, gt_ldisplay, gs_hdisplay, gs_ldisplay,
          gt_hso, gs_hso, gt_lso, gs_lso.

  READ TABLE gt_tadisplay INTO gs_tadisplay INDEX pv_row.

*-- Get head data
  SELECT orderid, bpid, custid, conditionid, order_date, cancel_deadline,
         order_type, total_amount, currency, cancel_reason, order_status,
         billing_status, srv_end_status
    FROM zc103sdt0006
    WHERE orderid EQ @gs_tadisplay-orderid
    INTO CORRESPONDING FIELDS OF TABLE @gt_hso.

  IF gt_hso IS INITIAL.
    MESSAGE i000 WITH TEXT-e07 DISPLAY LIKE 'E'.
    EXIT.
  ENDIF.

*-- GET line DATA
  SELECT orderid, orderitemno, bookingid, transportid, charged_item, description,
        ticket_quantity, ticket_unit, cargo_weight, cargo_unit, unit_price,
        tax_amount, discount, currency, used_mileage, order_status, srv_end_status
  FROM zc103sdt0007
  WHERE orderid EQ @gs_tadisplay-orderid
  INTO CORRESPONDING FIELDS OF TABLE @gt_lso.

*-- MOVE data TO Head display
  LOOP AT gt_hso INTO gs_hso.
    gs_hdisplay = CORRESPONDING #( gs_hso ).
    APPEND gs_hdisplay TO gt_hdisplay.
  ENDLOOP.

*-- MOVE data TO Line display
  LOOP AT gt_lso INTO gs_lso.
    gs_ldisplay = CORRESPONDING #( gs_lso ).
    APPEND gs_ldisplay TO gt_ldisplay.
  ENDLOOP.

  PERFORM set_so_head_to_text.
  PERFORM set_so_line_to_text.

  PERFORM refresh_brtop_table.
  PERFORM refresh_brbottom_table.

  CALL METHOD cl_gui_cfw=>set_new_ok_code
    EXPORTING
      new_code = 'ENTER'.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form insert_cc_data
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM insert_cc_data .

  DATA : lt_roid           TYPE lvc_t_roid,
         ls_roid           TYPE lvc_s_roid,
         lv_answer(1),
         lv_tabix          TYPE sy-tabix,
         lv_transportid    TYPE zc103sdt0017-transportid,
         lv_cur_load_count TYPE i.

  CALL METHOD go_103_alv_grid->get_selected_rows
    IMPORTING
      et_row_no = lt_roid.

  IF lt_roid IS INITIAL.
    MESSAGE i000 WITH TEXT-e01 DISPLAY LIKE 'E'.
    EXIT.
  ENDIF.

*-- Pop-up Dialog
  PERFORM set_popup_to_confirm CHANGING lv_answer.
  CHECK lv_answer EQ '1'.

*-- For CHECK credit restirct using so total_amount
  DATA : lv_so_total TYPE wrbtr.

*-- Set field : Text to Value
  PERFORM set_cc_table_to_value.

*-- CHECK so_status EQ f
  DATA : lv_cctabix TYPE sy-tabix.

  LOOP AT lt_roid INTO ls_roid.
    READ TABLE gt_ccdisplay INTO gs_ccdisplay INDEX ls_roid-row_id.
    lv_cctabix = sy-tabix.
    IF gs_ccdisplay-so_status EQ 'F'.
      MESSAGE i001 WITH gs_ccdisplay-input_head '건은 유효하지 않은 데이터 입니다.' DISPLAY LIKE 'E'.
      PERFORM set_head_value_to_text.
      PERFORM refresh_cc_table.
*-- Set Screen Number
      gv_subscreen = '0103'.
      LEAVE TO SCREEN 100.
    ELSEIF gs_ccdisplay-so_status EQ 'Y'.
      MESSAGE i001 WITH gs_ccdisplay-input_head '건은 오더 전환이 완료된 건입니다' DISPLAY LIKE 'E'.
      PERFORM set_head_value_to_text.
      PERFORM refresh_cc_table.
*-- Set Screen Number
      gv_subscreen = '0103'.
      LEAVE TO SCREEN 100.
    ENDIF.

*-- GET so DATA by bpid
    LOOP AT gt_so INTO gs_so WHERE bpid EQ gs_ccdisplay-bpid.
      lv_so_total += gs_so-total_amount.
    ENDLOOP.

*-- CHECK Credit Available
    DATA : lv_input_head TYPE zc103sdt0015-input_head.

    READ TABLE gt_credit INTO gs_credit WITH KEY bpid = gs_ccdisplay-bpid.
    DATA(lv_rest_credit) = gs_credit-limit_amt_year - ( gs_credit-used_amt_year + lv_so_total ).
    IF ( lv_rest_credit < gs_ccdisplay-total_price ).
      MESSAGE i001 WITH gs_ccdisplay-input_head '건은 여신 한도 초과로 인해 오더 전환이 불가능합니다.' DISPLAY LIKE 'E'.
      gs_ccdisplay-so_status = 'F'.
      lv_input_head = gs_ccdisplay-input_head.
      MODIFY gt_ccdisplay FROM gs_ccdisplay INDEX lv_cctabix TRANSPORTING so_status.
      UPDATE zc103sdt0015 SET so_status = 'F' WHERE input_head = lv_input_head.
      PERFORM set_head_value_to_text.
      PERFORM refresh_cc_table.
*-- Set Screen Number
      gv_subscreen = '0103'.
      LEAVE TO SCREEN 100.
    ENDIF.
  ENDLOOP.

*-- Insert Data to Tables
  LOOP AT lt_roid INTO ls_roid.
**********************************************************************
*-- For '화물 예약 테이블'
    READ TABLE gt_ccdisplay INTO gs_ccdisplay INDEX ls_roid-row_id.
    lv_tabix = sy-tabix.

*-- Check Loaded count
    SELECT SINGLE current_loaded_count_int
      FROM zc103sdt0026
      WHERE scheduleid EQ @gs_ccdisplay-scheduleid
      INTO ( @lv_cur_load_count ).

    IF ( lv_cur_load_count > 10 ).
      MESSAGE i000 WITH TEXT-e11 DISPLAY LIKE 'E'.
      gv_subscreen = '0103'.

      PERFORM set_head_value_to_text.
      PERFORM refresh_cc_table.

      CALL METHOD cl_gui_cfw=>set_new_ok_code
        EXPORTING
          new_code = 'ENTER'.

      LEAVE TO SCREEN 100.

    ENDIF.

    PERFORM insert_cc_transport_table USING lv_transportid lv_cur_load_count.
**********************************************************************
*-- For '판매오더 헤더, 라인'
    PERFORM insert_cc_sales_order USING lv_transportid.

    MODIFY gt_ccdisplay FROM gs_ccdisplay INDEX lv_tabix.

**********************************************************************
*-- 전체 DB Table 적용
    LOOP AT gt_cc INTO gs_cc WHERE so_status = 'Y'.
      UPDATE zc103sdt0015 SET so_status = gs_cc-so_status WHERE input_head = gs_cc-input_head
                                                            AND input_line = gs_cc-input_line.
    ENDLOOP.
  ENDLOOP.

  IF sy-subrc EQ 0.
    COMMIT WORK.
  ELSE.
    ROLLBACK WORK.
  ENDIF.

  PERFORM set_head_value_to_text.
  PERFORM refresh_cc_table.

  MESSAGE i000 WITH TEXT-s01 DISPLAY LIKE 'S'.

  CALL METHOD cl_gui_cfw=>set_new_ok_code
    EXPORTING
      new_code = 'ENTER'.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form insert_billing
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM insert_billing USING pv_orderid pv_bookingid.

  DATA : lv_number TYPE n LENGTH 6.

  DATA : lt_hbill        TYPE TABLE OF zc103sdt0004,
         ls_hbill        TYPE zc103sdt0004,
         lt_lbill        TYPE TABLE OF zc103sdt0005,
         ls_lbill        TYPE zc103sdt0005,
         lv_gjahr        TYPE bkpf-gjahr,
         lv_tax          TYPE wert8,
         lv_belnr        TYPE belnr_d,
         lv_message      TYPE char100,
         lv_billitemno   TYPE i,
         lv_discount     TYPE i,
         lv_discountrate TYPE p DECIMALS 1.

*-- BillNUM -> Number Range(zbillnum)
  CALL FUNCTION 'NUMBER_GET_NEXT'
    EXPORTING
      nr_range_nr = '01'
      object      = 'ZBILLNUM'
    IMPORTING
      number      = lv_number
    EXCEPTIONS
      OTHERS      = 1.

  IF sy-subrc = 0.
    CONCATENATE 'BL' lv_number INTO ls_hbill-billnum.
  ELSE.
    MESSAGE i001 WITH TEXT-e10 DISPLAY LIKE 'E'.
    EXIT.
  ENDIF.

  ls_hbill-orderid = pv_orderid.

*-- Get Document Number
  lv_gjahr = sy-datum+0(4).
  lv_tax = gs_cudisplay-total_price / 10.

  IF ( gs_cu-used_mileage EQ 0 ).
    CALL FUNCTION 'ZC1FM03FI0003'
      EXPORTING
        iv_billnum = ls_hbill-billnum
        iv_gjahr   = lv_gjahr
        iv_custid  = gs_cudisplay-custid
        iv_total   = gs_cudisplay-total_price
        iv_type    = 'C'
        iv_b2ctype = 'C'
        iv_tax     = lv_tax
        iv_waers   = gs_cudisplay-currency
      IMPORTING
        ev_belnr   = lv_belnr
        ev_message = lv_message.

  ELSEIF ( gs_cu-used_mileage < gs_cu-total_price ).
    CALL FUNCTION 'ZC1FM03FI0003'
      EXPORTING
        iv_billnum = ls_hbill-billnum
        iv_gjahr   = lv_gjahr
        iv_custid  = gs_cudisplay-custid
        iv_total   = gs_cudisplay-total_price
        iv_type    = 'C'
        iv_b2ctype = 'A'
        iv_tax     = lv_tax
        iv_waers   = gs_cudisplay-currency
*       IV_USCODE  =
        iv_mileage = gs_cu-used_mileage
      IMPORTING
        ev_belnr   = lv_belnr
        ev_message = lv_message.

  ELSEIF ( gs_cu-used_mileage = gs_cu-total_price ).
    CALL FUNCTION 'ZC1FM03FI0003'
      EXPORTING
        iv_billnum = ls_hbill-billnum
        iv_gjahr   = lv_gjahr
        iv_custid  = gs_cudisplay-custid
        iv_total   = gs_cudisplay-total_price
        iv_type    = 'C'
        iv_b2ctype = 'B'
        iv_tax     = lv_tax
        iv_waers   = gs_cudisplay-currency
        iv_mileage = gs_cu-used_mileage
      IMPORTING
        ev_belnr   = lv_belnr
        ev_message = lv_message.
  ENDIF.

  IF ( sy-subrc <> 0 ).
    MESSAGE i000 WITH TEXT-e08 DISPLAY LIKE 'E'.
    EXIT.
  ELSE.
    ls_hbill-doc_flag = 'Y'.
  ENDIF.

  ls_hbill-belnr = lv_belnr.
  ls_hbill-gjahr = lv_gjahr.
  ls_hbill-custid = gs_cudisplay-custid.
  ls_hbill-total_amount = gs_cudisplay-total_price.
  ls_hbill-tax_amount = gs_cudisplay-total_price / 10.
  ls_hbill-currency = gs_cudisplay-currency.
  ls_hbill-billing_status = 'Y'.
  ls_hbill-mail_status = 'Y'.
  ls_hbill-billing_date = gs_cudisplay-input_date.
  ls_hbill-credit_status = 'X'.
  ls_hbill-erdat = sy-datum.
  ls_hbill-erzet = sy-uzeit.
  ls_hbill-ernam = sy-uname.

  APPEND ls_hbill TO lt_hbill.

*-- Update billing Head
  MODIFY zc103sdt0004 FROM TABLE lt_hbill.

*-- For biling Line Update
  LOOP AT gt_cu INTO gs_cu WHERE input_head = gs_cudisplay-input_head.
    lv_billitemno += 1.
    ls_lbill-billnum = ls_hbill-billnum.
    ls_lbill-billitemno = lv_billitemno.
    ls_lbill-bookingid = pv_bookingid.
    ls_lbill-charged_item = 'A'.
    ls_lbill-ticket_quantity = gs_cu-ticket_quantity.
    ls_lbill-ticket_unit = gs_cu-ticket_unit.
    ls_lbill-unit_price = gs_cu-unit_price.

*-- Get discount rate
    SELECT SINGLE discountrate
      FROM zc103sdt0003
      WHERE conditionid EQ @gs_cudisplay-conditionid
      INTO ( @lv_discount ).

    lv_discountrate = lv_discount / 100.

    ls_lbill-unit_discount_amount = ( gs_cu-total_price * lv_discountrate ).
    ls_lbill-currency = gs_cu-currency.
    ls_lbill-erdat = sy-datum.
    ls_lbill-ernam = sy-uname.
    ls_lbill-erzet = sy-uzeit.

    APPEND ls_lbill TO lt_lbill.

  ENDLOOP.

*-- Insert Bill Line data
  MODIFY zc103sdt0005 FROM TABLE lt_lbill.

  IF sy-subrc EQ 0.
    COMMIT WORK.
  ELSE.
    ROLLBACK WORK.
  ENDIF.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form insert_cc_transport_table
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM insert_cc_transport_table USING pv_transportid
                                     pv_cur_load_count.

  DATA : lv_number     TYPE n LENGTH 6,
         lv_departdate TYPE zc103sdt0018-departdate.

  DATA : lt_trans TYPE TABLE OF zc103sdt0017,
         ls_trans TYPE zc103sdt0017.

*-- TRANSPORTID -> Number Range(ztransid)
  CALL FUNCTION 'NUMBER_GET_NEXT'
    EXPORTING
      nr_range_nr = '01'
      object      = 'ZTRANSID'
    IMPORTING
      number      = lv_number
    EXCEPTIONS
      OTHERS      = 1.

  IF sy-subrc = 0.
    CONCATENATE 'TR' lv_number INTO ls_trans-transportid.
  ELSE.
    MESSAGE i001 WITH TEXT-e09 DISPLAY LIKE 'E'.
    EXIT.
  ENDIF.

  pv_transportid = ls_trans-transportid.

  ls_trans-bpid = gs_ccdisplay-bpid.
  ls_trans-matid = gs_ccdisplay-matid.
  ls_trans-countryfrom = gs_ccdisplay-countryfrom.
  ls_trans-countryto = gs_ccdisplay-countryto.

*-- Get Transport depart date
  SELECT SINGLE departdate
    FROM zc103sdt0018
    WHERE scheduleid EQ @gs_ccdisplay-scheduleid
    INTO ( @lv_departdate ).

  ls_trans-tdate = lv_departdate.
  ls_trans-flightid = gs_ccdisplay-flightid.
  ls_trans-scheduleid = gs_ccdisplay-scheduleid.
  ls_trans-weight = gs_ccdisplay-weight.
  ls_trans-weight_unit = gs_ccdisplay-weight_unit.
  ls_trans-volume = gs_ccdisplay-volume.
  ls_trans-uld_type = 'A'.
  ls_trans-cc_checked = 'N'.

*-- Check confirmed
  lv_departdate -= 14.
  IF ( lv_departdate < sy-datum ).
    ls_trans-is_confirmed = 'Y'.
  ELSE.
    ls_trans-is_confirmed = 'N'.
  ENDIF.

  ls_trans-priority = '1'.
  ls_trans-price = gs_ccdisplay-total_price.
  ls_trans-currency = gs_ccdisplay-currency.
  ls_trans-erdat = sy-datum.
  ls_trans-ernam = sy-uname.
  ls_trans-erzet = sy-uzeit.

  APPEND ls_trans TO lt_trans.

*-- Insert DB Table
  MODIFY zc103sdt0017 FROM TABLE lt_trans.

*-- Count Load Count
  pv_cur_load_count += 1.

*-- Update DB Table
  UPDATE zc103sdt0026 SET current_loaded_count_int = pv_cur_load_count
                      WHERE scheduleid = gs_ccdisplay-scheduleid.


  IF sy-subrc EQ 0.
    COMMIT WORK.
  ELSE.
    ROLLBACK WORK.
  ENDIF.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form insert_cc_sales_order
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> LV_TRANSPORTID
*&---------------------------------------------------------------------*
FORM insert_cc_sales_order  USING    pv_transportid.

  DATA : lv_number     TYPE n LENGTH 6,
         lv_itemno     TYPE i,
         lv_departdate TYPE zc103sdt0018-departdate.

  DATA : lt_hso TYPE TABLE OF zc103sdt0006,
         ls_hso TYPE zc103sdt0006,
         lt_lso TYPE TABLE OF zc103sdt0007,
         ls_lso TYPE zc103sdt0007.

  DATA : lv_discount      TYPE i,
         lv_discount_rate TYPE p DECIMALS 1.

**********************************************************************
*-- Set SO Head data
**********************************************************************
*-- Orderid Number range
  CLEAR : lv_number.
  CALL FUNCTION 'NUMBER_GET_NEXT'
    EXPORTING
      nr_range_nr = '01'
      object      = 'ZORDERID'
    IMPORTING
      number      = lv_number
    EXCEPTIONS
      OTHERS      = 1.

  IF sy-subrc EQ 0.
    CONCATENATE 'SO' lv_number INTO ls_hso-orderid.
  ELSE.
    MESSAGE e000 WITH TEXT-e05.
    EXIT.
  ENDIF.

  ls_hso-bpid = gs_ccdisplay-bpid.
  ls_hso-conditionid = gs_ccdisplay-conditionid.
  ls_hso-order_date = gs_ccdisplay-input_date.

*-- Get Departdate
  SELECT SINGLE departdate
    FROM zc103sdt0018
    WHERE scheduleid EQ @gs_ccdisplay-scheduleid
    INTO ( @lv_departdate ).

*-- Calculate Cancel Deadline
  lv_departdate -= 14.
  ls_hso-cancel_deadline = lv_departdate.
  ls_hso-order_type = 'B'.
  ls_hso-total_amount = gs_ccdisplay-total_price.
  ls_hso-currency = gs_ccdisplay-currency.
  ls_hso-order_status = 'N'.
  ls_hso-billing_status = 'N'.
  ls_hso-srv_end_status = 'N'.
  ls_hso-erdat = sy-datum.
  ls_hso-ernam = sy-uname.
  ls_hso-erzet = sy-uzeit.

  APPEND ls_hso TO lt_hso.

*-- Insert SO head data
  MODIFY zc103sdt0006 FROM TABLE lt_hso.

  IF sy-subrc EQ 0.
    gs_ccdisplay-orderid = ls_hso-orderid.
  ENDIF.

**********************************************************************
* Set line data
**********************************************************************
  LOOP AT gt_cc ASSIGNING FIELD-SYMBOL(<fs_cc>) WHERE input_head = gs_ccdisplay-input_head.
    CLEAR : ls_lso.
    lv_itemno += 1.
    ls_lso-orderid = ls_hso-orderid.
    ls_lso-orderitemno = lv_itemno.
    ls_lso-transportid = pv_transportid.
    ls_lso-charged_item = 'B'.
    ls_lso-cargo_weight = <fs_cc>-weight.
    ls_lso-cargo_unit = <fs_cc>-weight_unit.
    ls_lso-unit_price = <fs_cc>-unit_price.
    ls_lso-tax_amount = <fs_cc>-total_price / 10.

*-- GET discount percent
    SELECT SINGLE discountrate
      FROM zc103sdt0003
      WHERE conditionid EQ @<fs_cc>-conditionid
      INTO ( @lv_discount ).

    lv_discount_rate = lv_discount / 100.

    ls_lso-discount = ( <fs_cc>-unit_price * lv_discount_rate ) * <fs_cc>-weight.
    ls_lso-currency = <fs_cc>-currency.
    ls_lso-order_status = 'N'.
    ls_lso-srv_end_status = 'N'.

    <fs_cc>-so_status = 'Y'.

    APPEND ls_lso TO lt_lso.

  ENDLOOP.

*-- Insert SO line Data
  MODIFY zc103sdt0007 FROM TABLE lt_lso.

  IF ( sy-subrc EQ 0 ).
    gs_ccdisplay-so_status = 'Y'.
    COMMIT WORK.
  ELSE.
    ROLLBACK WORK.
  ENDIF.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form cc_double_click
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> E_ROW
*&      --> E_COLUMN
*&---------------------------------------------------------------------*
FORM cc_double_click  USING    pv_row
                               pv_column.

  DATA : lv_tabix TYPE sy-tabix.

  CLEAR : gt_hdisplay, gt_ldisplay, gs_hdisplay, gs_ldisplay,
          gt_hso, gs_hso, gt_lso, gs_lso.

  READ TABLE gt_ccdisplay INTO gs_ccdisplay INDEX pv_row.

*-- Get head data
  SELECT orderid, bpid, custid, conditionid, order_date, cancel_deadline,
         order_type, total_amount, currency, cancel_reason, order_status,
         billing_status, srv_end_status
    FROM zc103sdt0006
    WHERE orderid EQ @gs_ccdisplay-orderid
    INTO CORRESPONDING FIELDS OF TABLE @gt_hso.

  IF gt_hso IS INITIAL.
    MESSAGE i000 WITH TEXT-e07 DISPLAY LIKE 'E'.
    EXIT.
  ENDIF.

*-- GET line DATA
  SELECT orderid, orderitemno, bookingid, transportid, charged_item, description,
          ticket_quantity, ticket_unit, cargo_weight, cargo_unit, unit_price,
          tax_amount, discount, currency, used_mileage, order_status, srv_end_status
  FROM zc103sdt0007
  WHERE orderid EQ @gs_ccdisplay-orderid
  INTO CORRESPONDING FIELDS OF TABLE @gt_lso.

*-- MOVE data TO Head display
  LOOP AT gt_hso INTO gs_hso.
    gs_hdisplay = CORRESPONDING #( gs_hso ).
    APPEND gs_hdisplay TO gt_hdisplay.
  ENDLOOP.

*-- MOVE data TO Line display
  LOOP AT gt_lso INTO gs_lso.
    gs_ldisplay = CORRESPONDING #( gs_lso ).
    APPEND gs_ldisplay TO gt_ldisplay.
  ENDLOOP.

  PERFORM set_so_head_to_text.
  PERFORM set_so_line_to_text.

  PERFORM refresh_brtop_table.
  PERFORM refresh_brbottom_table.

  CALL METHOD cl_gui_cfw=>set_new_ok_code
    EXPORTING
      new_code = 'ENTER'.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_cc_table_to_value
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_cc_table_to_value .

*-- CONVERT TEXT to Value
  LOOP AT gt_ccdisplay ASSIGNING FIELD-SYMBOL(<fs_cc>).
*-- Input_type
    CASE <fs_cc>-input_type.
      WHEN '일반 고객(B2C)'.
        <fs_cc>-input_type = 'CU'.
      WHEN '계약 화물사(B2B)'.
        <fs_cc>-input_type = 'CC'.
      WHEN '미계약 화물사(B2B)'.
        <fs_cc>-input_type = 'NC'.
      WHEN '여행사(B2B)'.
        <fs_cc>-input_type = 'TA'.
    ENDCASE.

*-- Countryfrom
    CASE <fs_cc>-countryfrom.
      WHEN '대한민국(인천)'.
        <fs_cc>-countryfrom = '00'.
      WHEN '대한민국(부산/김해)'.
        <fs_cc>-countryfrom = '01'.
      WHEN '오스트레일리아(시드니)'.
        <fs_cc>-countryfrom = '02'.
      WHEN '베트남(하노이)'.
        <fs_cc>-countryfrom = '03'.
      WHEN '아랍에미리트(두바이)'.
        <fs_cc>-countryfrom = '04'.
      WHEN '독일(프랑크푸르트)'.
        <fs_cc>-countryfrom = '05'.
      WHEN '미국(LA)'.
        <fs_cc>-countryfrom = '06'.
    ENDCASE.

*-- Countryto
    CASE <fs_cc>-countryto.
      WHEN '대한민국(인천)'.
        <fs_cc>-countryto = '00'.
      WHEN '대한민국(부산/김해)'.
        <fs_cc>-countryto = '01'.
      WHEN '오스트레일리아(시드니)'.
        <fs_cc>-countryto = '02'.
      WHEN '베트남(하노이)'.
        <fs_cc>-countryto = '03'.
      WHEN '아랍에미리트(두바이)'.
        <fs_cc>-countryto = '04'.
      WHEN '독일(프랑크푸르트)'.
        <fs_cc>-countryto = '05'.
      WHEN '미국(LA)'.
        <fs_cc>-countryto = '06'.
    ENDCASE.

*-- so_status
    CASE <fs_cc>-so_status.
      WHEN '판매오더 전환 완료'.
        <fs_cc>-so_status = 'Y'.
      WHEN '판매오더 전환 미완료'.
        <fs_cc>-so_status = 'N'.
      WHEN '유효성 검사 실패'.
        <fs_cc>-so_status = 'F'.
    ENDCASE.

  ENDLOOP.

  UNASSIGN : <fs_cc>.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form insert_nc_data
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM insert_nc_data .

  DATA : lt_roid           TYPE lvc_t_roid,
         ls_roid           TYPE lvc_s_roid,
         lv_answer(1),
         lv_tabix          TYPE sy-tabix,
         lv_transportid    TYPE zc103sdt0017-transportid,
         lv_cur_load_count TYPE i.

  CALL METHOD go_104_alv_grid->get_selected_rows
    IMPORTING
      et_row_no = lt_roid.

*-- For CHECK credit restirct using so total_amount
  DATA : lv_so_total TYPE wrbtr.

  IF lt_roid IS INITIAL.
    MESSAGE i000 WITH TEXT-e01 DISPLAY LIKE 'E'.
    EXIT.
  ENDIF.

*-- Pop-up Dialog
  PERFORM set_popup_to_confirm CHANGING lv_answer.
  CHECK lv_answer EQ '1'.

*-- SET FIELD : Text to Value
  PERFORM set_nc_table_to_value.

*-- CHECK so_status EQ f
  DATA : lv_nctabix TYPE sy-tabix.

  LOOP AT lt_roid INTO ls_roid.
    READ TABLE gt_ncdisplay INTO gs_ncdisplay INDEX ls_roid-row_id.
    lv_nctabix = sy-tabix.
    IF gs_ncdisplay-so_status EQ 'F'.
      MESSAGE i001 WITH gs_ncdisplay-input_head '건은 유효하지 않은 데이터 입니다.' DISPLAY LIKE 'E'.
      PERFORM set_head_value_to_text.
      PERFORM refresh_nc_table.
*-- Set Screen Number
      gv_subscreen = '0104'.
      LEAVE TO SCREEN 100.
    ELSEIF gs_ncdisplay-so_status EQ 'Y'.
      MESSAGE i001 WITH gs_ncdisplay-input_head '건은 오더 전환이 완료된 건입니다' DISPLAY LIKE 'E'.
      PERFORM set_head_value_to_text.
      PERFORM refresh_nc_table.
*-- Set Screen Number
      gv_subscreen = '0104'.
      LEAVE TO SCREEN 100.
    ENDIF.

*-- GET so DATA by bpid
    LOOP AT gt_so INTO gs_so WHERE bpid EQ gs_ncdisplay-bpid.
      lv_so_total += gs_so-total_amount.
    ENDLOOP.

*-- CHECK Credit Available
    DATA : lv_input_head TYPE zc103sdt0015-input_head.
    READ TABLE gt_credit INTO gs_credit WITH KEY bpid = gs_ncdisplay-bpid.
    DATA(lv_rest_credit) = gs_credit-limit_amt_year - ( gs_credit-used_amt_year + lv_so_total ).
    IF ( lv_rest_credit < gs_ncdisplay-total_price ).
      MESSAGE i001 WITH gs_ncdisplay-input_head '건은 여신 한도 초과로 인해 오더 전환이 불가능합니다.' DISPLAY LIKE 'E'.
      gs_ncdisplay-so_status = 'F'.
      lv_input_head = gs_ncdisplay-input_head.
      MODIFY gt_ncdisplay FROM gs_ncdisplay INDEX lv_nctabix TRANSPORTING so_status.
      UPDATE zc103sdt0015 SET so_status = 'F' WHERE input_head = lv_input_head.
      PERFORM set_head_value_to_text.
      PERFORM refresh_nc_table.
*-- Set Screen Number
      gv_subscreen = '0104'.
      LEAVE TO SCREEN 100.
    ENDIF.
  ENDLOOP.

*-- Insert Data to Tables
  LOOP AT lt_roid INTO ls_roid.
**********************************************************************
*-- For '화물 예약 테이블'
    READ TABLE gt_ncdisplay INTO gs_ncdisplay INDEX ls_roid-row_id.
    lv_tabix = sy-tabix.

*-- CHECK Loaded count
    SELECT SINGLE current_loaded_count_int
      FROM zc103sdt0026
      WHERE scheduleid EQ @gs_ncdisplay-scheduleid
      INTO ( @lv_cur_load_count ).

    IF ( lv_cur_load_count > 10 ).
      MESSAGE i000 WITH TEXT-e11 DISPLAY LIKE 'E'.
      gv_subscreen = '0104'.

      PERFORM set_head_value_to_text.
      PERFORM refresh_nc_table.

      CALL METHOD cl_gui_cfw=>set_new_ok_code
        EXPORTING
          new_code = 'ENTER'.

      LEAVE TO SCREEN 100.

    ENDIF.

    PERFORM insert_nc_transport_table USING lv_transportid lv_cur_load_count.

**********************************************************************
*-- For '판매오더 헤더, 라인'
    PERFORM insert_nc_sales_order USING lv_transportid.

    MODIFY gt_ncdisplay FROM gs_ncdisplay INDEX lv_tabix.

**********************************************************************
*-- 전체 DB Table 적용
    LOOP AT gt_nc INTO gs_nc WHERE so_status = 'Y'.
      UPDATE zc103sdt0015 SET so_status = gs_nc-so_status WHERE input_head = gs_nc-input_head
                                                            AND input_line = gs_nc-input_line.
    ENDLOOP.
  ENDLOOP.

  IF sy-subrc EQ 0.
    COMMIT WORK.
  ELSE.
    ROLLBACK WORK.
  ENDIF.

  PERFORM set_head_value_to_text.
  PERFORM refresh_nc_table.

  MESSAGE i000 WITH TEXT-s01 DISPLAY LIKE 'S'.

  CALL METHOD cl_gui_cfw=>set_new_ok_code
    EXPORTING
      new_code = 'ENTER'.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_nc_table_to_value
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_nc_table_to_value .

*-- CONVERT TEXT to Value
  LOOP AT gt_ncdisplay ASSIGNING FIELD-SYMBOL(<fs_nc>).
*-- Input_type
    CASE <fs_nc>-input_type.
      WHEN '일반 고객(B2C)'.
        <fs_nc>-input_type = 'CU'.
      WHEN '계약 화물사(B2B)'.
        <fs_nc>-input_type = 'CC'.
      WHEN '미계약 화물사(B2B)'.
        <fs_nc>-input_type = 'NC'.
      WHEN '여행사(B2B)'.
        <fs_nc>-input_type = 'TA'.
    ENDCASE.

*-- Countryfrom
    CASE <fs_nc>-countryfrom.
      WHEN '대한민국(인천)'.
        <fs_nc>-countryfrom = '00'.
      WHEN '대한민국(부산/김해)'.
        <fs_nc>-countryfrom = '01'.
      WHEN '오스트레일리아(시드니)'.
        <fs_nc>-countryfrom = '02'.
      WHEN '베트남(하노이)'.
        <fs_nc>-countryfrom = '03'.
      WHEN '아랍에미리트(두바이)'.
        <fs_nc>-countryfrom = '04'.
      WHEN '독일(프랑크푸르트)'.
        <fs_nc>-countryfrom = '05'.
      WHEN '미국(LA)'.
        <fs_nc>-countryfrom = '06'.
    ENDCASE.

*-- Countryto
    CASE <fs_nc>-countryto.
      WHEN '대한민국(인천)'.
        <fs_nc>-countryto = '00'.
      WHEN '대한민국(부산/김해)'.
        <fs_nc>-countryto = '01'.
      WHEN '오스트레일리아(시드니)'.
        <fs_nc>-countryto = '02'.
      WHEN '베트남(하노이)'.
        <fs_nc>-countryto = '03'.
      WHEN '아랍에미리트(두바이)'.
        <fs_nc>-countryto = '04'.
      WHEN '독일(프랑크푸르트)'.
        <fs_nc>-countryto = '05'.
      WHEN '미국(LA)'.
        <fs_nc>-countryto = '06'.
    ENDCASE.

*-- so_status
    CASE <fs_nc>-so_status.
      WHEN '판매오더 전환 완료'.
        <fs_nc>-so_status = 'Y'.
      WHEN '판매오더 전환 미완료'.
        <fs_nc>-so_status = 'N'.
      WHEN '유효성 검사 실패'.
        <fs_nc>-so_status = 'F'.
    ENDCASE.

  ENDLOOP.

  UNASSIGN : <fs_nc>.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form insert_nc_transport_table
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> LV_TRANSPORTID
*&---------------------------------------------------------------------*
FORM insert_nc_transport_table  USING    pv_transportid
                                         pv_cur_load_count.

  DATA : lv_number     TYPE n LENGTH 6,
         lv_departdate TYPE zc103sdt0018-departdate.

  DATA : lt_trans TYPE TABLE OF zc103sdt0017,
         ls_trans TYPE zc103sdt0017.

*-- transportid -> Number Range(ztransid)
  CALL FUNCTION 'NUMBER_GET_NEXT'
    EXPORTING
      nr_range_nr = '01'
      object      = 'ZTRANSID'
    IMPORTING
      number      = lv_number
    EXCEPTIONS
      OTHERS      = 1.

  IF sy-subrc = 0.
    CONCATENATE 'TR' lv_number INTO ls_trans-transportid.
  ELSE.
    MESSAGE i001 WITH TEXT-e09 DISPLAY LIKE 'E'.
    EXIT.
  ENDIF.

  pv_transportid = ls_trans-transportid.

  ls_trans-bpid = gs_ncdisplay-bpid.
  ls_trans-matid = gs_ncdisplay-matid.
  ls_trans-countryfrom = gs_ncdisplay-countryfrom.
  ls_trans-countryto = gs_ncdisplay-countryto.

*-- Get Transport depart date
  SELECT SINGLE departdate
    FROM zc103sdt0018
    WHERE scheduleid EQ @gs_ncdisplay-scheduleid
    INTO ( @lv_departdate ).

  ls_trans-tdate = lv_departdate.
  ls_trans-flightid = gs_ncdisplay-flightid.
  ls_trans-scheduleid = gs_ncdisplay-scheduleid.
  ls_trans-weight = gs_ncdisplay-weight.
  ls_trans-weight_unit = gs_ncdisplay-weight_unit.
  ls_trans-volume = gs_ncdisplay-volume.
  ls_trans-uld_type = 'A'.
  ls_trans-cc_checked = 'N'.

*-- Check confirmed
  lv_departdate -= 14.
  IF ( lv_departdate < sy-datum ).
    ls_trans-is_confirmed = 'Y'.
  ELSE.
    ls_trans-is_confirmed = 'N'.
  ENDIF.

  ls_trans-priority = '2'.
  ls_trans-price = gs_ncdisplay-total_price.
  ls_trans-currency = gs_ncdisplay-currency.
  ls_trans-erdat = sy-datum.
  ls_trans-ernam = sy-uname.
  ls_trans-erzet = sy-uzeit.

  APPEND ls_trans TO lt_trans.

*-- Insert DB Table
  MODIFY zc103sdt0017 FROM TABLE lt_trans.

*-- Count LOAD Count
  pv_cur_load_count += 1.

*-- Update DB Table
  UPDATE zc103sdt0026 SET current_loaded_count_int = pv_cur_load_count
                      WHERE scheduleid = gs_ncdisplay-scheduleid.

  IF sy-subrc EQ 0.
    COMMIT WORK.
  ELSE.
    ROLLBACK WORK.
  ENDIF.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form insert_nc_sales_order
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> LV_TRANSPORTID
*&---------------------------------------------------------------------*
FORM insert_nc_sales_order  USING    pv_transportid.

  DATA : lv_number     TYPE n LENGTH 6,
         lv_itemno     TYPE i,
         lv_departdate TYPE zc103sdt0018-departdate.

  DATA : lt_hso TYPE TABLE OF zc103sdt0006,
         ls_hso TYPE zc103sdt0006,
         lt_lso TYPE TABLE OF zc103sdt0007,
         ls_lso TYPE zc103sdt0007.

  DATA : lv_discount      TYPE i,
         lv_discount_rate TYPE p DECIMALS 1.

**********************************************************************
*-- Set SO Head data
**********************************************************************
*-- Orderid Number range
  CLEAR : lv_number.
  CALL FUNCTION 'NUMBER_GET_NEXT'
    EXPORTING
      nr_range_nr = '01'
      object      = 'ZORDERID'
    IMPORTING
      number      = lv_number
    EXCEPTIONS
      OTHERS      = 1.

  IF sy-subrc EQ 0.
    CONCATENATE 'SO' lv_number INTO ls_hso-orderid.
  ELSE.
    MESSAGE e000 WITH TEXT-e05.
    EXIT.
  ENDIF.

  ls_hso-bpid = gs_ncdisplay-bpid.
  ls_hso-conditionid = gs_ncdisplay-conditionid.
  ls_hso-order_date = gs_ncdisplay-input_date.

*-- Get Departdate
  SELECT SINGLE departdate
    FROM zc103sdt0018
    WHERE scheduleid EQ @gs_ncdisplay-scheduleid
    INTO ( @lv_departdate ).

*-- Calculate Cancel Deadline
  lv_departdate -= 14.
  ls_hso-cancel_deadline = lv_departdate.
  ls_hso-order_type = 'NB'.
  ls_hso-total_amount = gs_ncdisplay-total_price.
  ls_hso-currency = gs_ncdisplay-currency.
  ls_hso-order_status = 'N'.
  ls_hso-billing_status = 'N'.
  ls_hso-srv_end_status = 'N'.
  ls_hso-erdat = sy-datum.
  ls_hso-ernam = sy-uname.
  ls_hso-erzet = sy-uzeit.

  APPEND ls_hso TO lt_hso.

*-- Insert SO head data
  MODIFY zc103sdt0006 FROM TABLE lt_hso.

  IF sy-subrc EQ 0.
    gs_ncdisplay-orderid = ls_hso-orderid.
  ENDIF.

**********************************************************************
* Set line data
**********************************************************************
  LOOP AT gt_nc ASSIGNING FIELD-SYMBOL(<fs_nc>) WHERE input_head = gs_ncdisplay-input_head.
    CLEAR : ls_lso.
    lv_itemno += 1.
    ls_lso-orderid = ls_hso-orderid.
    ls_lso-orderitemno = lv_itemno.
    ls_lso-transportid = pv_transportid.
    ls_lso-charged_item = 'B'.
    ls_lso-cargo_weight = <fs_nc>-weight.
    ls_lso-cargo_unit = <fs_nc>-weight_unit.
    ls_lso-unit_price = <fs_nc>-unit_price.
    ls_lso-tax_amount = <fs_nc>-total_price / 10.

*-- GET discount percent
    SELECT SINGLE discountrate
      FROM zc103sdt0003
      WHERE conditionid EQ @<fs_nc>-conditionid
      INTO ( @lv_discount ).

    lv_discount_rate = lv_discount / 100.

    ls_lso-discount = ( <fs_nc>-unit_price * lv_discount_rate ) * <fs_nc>-weight.
    ls_lso-currency = <fs_nc>-currency.
    ls_lso-order_status = 'N'.
    ls_lso-srv_end_status = 'N'.

    <fs_nc>-so_status = 'Y'.

    APPEND ls_lso TO lt_lso.

  ENDLOOP.

*-- Insert SO line Data
  MODIFY zc103sdt0007 FROM TABLE lt_lso.

  IF ( sy-subrc EQ 0 ).
    gs_ncdisplay-so_status = 'Y'.
    COMMIT WORK.
  ELSE.
    ROLLBACK WORK.
  ENDIF.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form nc_double_click
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> E_ROW
*&      --> E_COLUMN
*&---------------------------------------------------------------------*
FORM nc_double_click  USING    pv_row
                               pv_column.

  DATA : lv_tabix TYPE sy-tabix.

  CLEAR : gt_hdisplay, gt_ldisplay, gs_hdisplay, gs_ldisplay,
          gt_hso, gs_hso, gt_lso, gs_lso.

  READ TABLE gt_ncdisplay INTO gs_ncdisplay INDEX pv_row.

*-- Get head data
  SELECT orderid, bpid, custid, conditionid, order_date, cancel_deadline,
         order_type, total_amount, currency, cancel_reason, order_status,
         billing_status, srv_end_status
    FROM zc103sdt0006
    WHERE orderid EQ @gs_ncdisplay-orderid
    INTO CORRESPONDING FIELDS OF TABLE @gt_hso.

  IF gt_hso IS INITIAL.
    MESSAGE i000 WITH TEXT-e07 DISPLAY LIKE 'E'.
    EXIT.
  ENDIF.

*-- GET line DATA
  SELECT orderid, orderitemno, bookingid, transportid, charged_item, description,
          ticket_quantity, ticket_unit, cargo_weight, cargo_unit, unit_price,
          tax_amount, discount, currency, used_mileage, order_status, srv_end_status
  FROM zc103sdt0007
  WHERE orderid EQ @gs_ncdisplay-orderid
  INTO CORRESPONDING FIELDS OF TABLE @gt_lso.

*-- MOVE data TO Head display
  LOOP AT gt_hso INTO gs_hso.
    gs_hdisplay = CORRESPONDING #( gs_hso ).
    APPEND gs_hdisplay TO gt_hdisplay.
  ENDLOOP.

*-- MOVE data TO Line display
  LOOP AT gt_lso INTO gs_lso.
    gs_ldisplay = CORRESPONDING #( gs_lso ).
    APPEND gs_ldisplay TO gt_ldisplay.
  ENDLOOP.

  PERFORM set_so_head_to_text.
  PERFORM set_so_line_to_text.

  PERFORM refresh_brtop_table.
  PERFORM refresh_brbottom_table.

  CALL METHOD cl_gui_cfw=>set_new_ok_code
    EXPORTING
      new_code = 'ENTER'.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form move_sales_order_page
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM move_sales_order_page .

  DATA : lv_answer(1).

  PERFORM popup_dialog CHANGING lv_answer.

  CHECK lv_answer EQ '1'.

  CALL TRANSACTION 'ZC103SD0002' AND SKIP FIRST SCREEN.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form popup_dialog
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      <-- LV_ANSWER
*&---------------------------------------------------------------------*
FORM popup_dialog  CHANGING pv_answer.

  CALL FUNCTION 'ZC1F030001'
    EXPORTING
      iv_action = '판매오더 관리 페이지로 이동'
    IMPORTING
      ev_answer = pv_answer.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form get_credit_data
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM get_credit_data .

  SELECT bpid, limit_amt_year, used_amt_year, eval_year
    FROM zc103sdt0016
    WHERE eval_year EQ @sy-datum+0(4)
    INTO CORRESPONDING FIELDS OF TABLE @gt_credit.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form get_so_data
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM get_so_data .

*-- Get SO Data(order_status = 'N')
  SELECT bpid, total_amount, order_status
    FROM zc103sdt0006
    WHERE order_status EQ 'N'
    INTO CORRESPONDING FIELDS OF TABLE @gt_so.

ENDFORM.

----------------------------------------------------------------------------------
Extracted by Direct Download Enterprise version 1.3.1 - E.G.Mellodew. 1998-2005 UK. Sap Release 758

